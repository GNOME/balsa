2005-02-07  Pawel Salek

	* src/address-book-config.c: compile with gtk-2.4
	* balsa.spec.in: distribute new icons.
	* configure.in: bump version to 2.3.0.
	* images/24x24/Makefile.am: fix install-data-hook:
	* libbalsa/Makefile.am: add missing i18n.h file.
	* libbalsa/mailbox_imap.c: remove debugging output.
	
2005-02-06 20:43  PeterB

	* configure.in, images/16x16/Makefile, images/16x16/Makefile.in,
	images/24x24/Makefile, images/24x24/Makefile.in,
	libbalsa/address-book-extern.c, libbalsa/address-book-ldif.c,
	libbalsa/address-book-vcard.c, libbalsa/address-book.c,
	libbalsa/address.c, libbalsa/body.c, libbalsa/filter-error.c,
	libbalsa/filter-file.c, libbalsa/filter.c,
	libbalsa/gmime-application-pkcs7.c, libbalsa/gmime-gpgme-context.c,
	libbalsa/i18n.h, libbalsa/identity.c, libbalsa/imap-server.c,
	libbalsa/libbalsa-conf.h, libbalsa/libbalsa.c,
	libbalsa/mailbox-filter.c, libbalsa/mailbox.c,
	libbalsa/mailbox_imap.c, libbalsa/mailbox_local.c,
	libbalsa/mailbox_maildir.c, libbalsa/mailbox_mbox.c,
	libbalsa/mailbox_mh.c, libbalsa/mailbox_pop3.c, libbalsa/message.c,
	libbalsa/mime.c, libbalsa/misc.c, libbalsa/send.c,
	libbalsa/server.c, libbalsa/source-viewer.c,
	libinit_balsa/balsa-druid-page-defclient.c,
	libinit_balsa/balsa-druid-page-directory.c,
	libinit_balsa/balsa-druid-page-finish.c,
	libinit_balsa/balsa-druid-page-user.c,
	libinit_balsa/balsa-druid-page-welcome.c,
	libinit_balsa/balsa-initdruid.c, libinit_balsa/helper.c,
	libinit_balsa/init_balsa.c, src/ab-window.c,
	src/address-book-config.c, src/address-book-config.h,
	src/balsa-app.c, src/balsa-index.c, src/balsa-mblist.c,
	src/balsa-message.c, src/filter-edit-callbacks.c,
	src/filter-edit-dialog.c, src/filter-export-callbacks.c,
	src/filter-export-dialog.c, src/filter-run-callbacks.c,
	src/filter-run-dialog.c, src/folder-conf.c,
	src/information-dialog.c, src/mailbox-conf.c, src/mailbox-node.c,
	src/main-window.c, src/main.c, src/message-window.c,
	src/pref-manager.c, src/print.c, src/save-restore.c,
	src/sendmsg-window.c, src/spell-check.c, src/store-address.c,
	src/toolbar-factory.c, src/toolbar-prefs.c: install and use
	libbalsa/i18n.h; migrate from GnomeFileEntry to GtkFileChooser;
	other Gnome-deprecation cleanup.

2005-02-06 18:45   Albrecht Dreß <albrecht dot dress at arcor dot de>

	* configure.in, images/Makefile.am, images/16x16/Makefile,
	images/16x16/Makefile.am, images/16x16/Makefile.in,
	images/16x16/balsa-encrypted.png, images/16x16/balsa-mark-all.png,
	images/16x16/balsa-mbox-draft.png,
	images/16x16/balsa-mbox-sent.png,
	images/16x16/balsa-mbox-tray-empty.png,
	images/16x16/balsa-mbox-tray-full.png,
	images/16x16/balsa-next-flagged.png,
	images/16x16/balsa-next-part.png,
	images/16x16/balsa-next-unread.png, images/16x16/balsa-next.png,
	images/16x16/balsa-postpone.png,
	images/16x16/balsa-previous-part.png,
	images/16x16/balsa-previous.png, images/16x16/balsa-reply-all.png,
	images/16x16/balsa-signature-bad.png,
	images/16x16/balsa-signature-good.png,
	images/16x16/balsa-signature-notrust.png,
	images/16x16/balsa-signature-unknown.png, images/24x24/Makefile,
	images/24x24/Makefile.am, images/24x24/Makefile.in,
	images/24x24/balsa-crypt-check.png, images/24x24/balsa-encrypt.png,
	images/24x24/balsa-encrypted.png, images/24x24/balsa-mark-all.png,
	images/24x24/balsa-marked-new.png,
	images/24x24/balsa-next-flagged.png,
	images/24x24/balsa-next-part.png,
	images/24x24/balsa-next-unread.png, images/24x24/balsa-next.png,
	images/24x24/balsa-postpone.png, images/24x24/balsa-preview.png,
	images/24x24/balsa-previous-part.png,
	images/24x24/balsa-previous.png, images/24x24/balsa-reply-all.png,
	images/24x24/balsa-sign.png, images/24x24/balsa-signature-bad.png,
	images/24x24/balsa-signature-good.png,
	images/24x24/balsa-signature-notrust.png,
	images/24x24/balsa-signature-unknown.png,
	images/24x24/balsa-trash-empty.png, images/mimetypes/Makefile.am,
	src/balsa-icons.c, src/balsa-icons.h, src/balsa-index.c,
	src/balsa-mblist.c, src/balsa-message.c, src/filter-edit-dialog.c,
	src/main-window.c, src/message-window.c, src/sendmsg-window.c,
	src/spell-check.c, src/toolbar-factory.c, src/toolbar-prefs.c:
	themable icons.

2005-02-06  Pawel Salek

	* libbalsa/mailbox_imap.c: fix some corner cases for
	LibBalsaMessageBody-to-imap section transformation.
	* libbalsa/mailbox_pop3.c: use backend SSL option.
	* libbalsa/imap/imap-commands.[ch]: do not guess whether part headers
	are to be fetched - say it clearly.
	* libbalsa/imap/imap-handle.c: process all data in IDLE callback.

2005-02-06  Pawel Salek

	* libbalsa/body.[hc]: filter CRLF on saving text parts.
	* src/balsa-message.c, sendmsg-window.c: adapt to changed API.
	* libbalsa/html.c: HAVE_GNOME related fixes.

2005-02-05 17:50  PeterB

	* libbalsa/Makefile.am, libinit_balsa/Makefile.am, src/Makefile.am:
	temporarily allow deprecated methods.

2005-02-05 17:49  Albrecht Dreß <albrecht dot dress at arcor dot de>

	* src/sendmsg-window.c: fix DnD problem with escaped filenames.

2005-02-03  Pawel Salek

	* libbalsa/imap/imap-handle.c: clean handle->sio field.

2005-02-02  Pawel Salek

	* configure.in: minor reordering fixes.
	* libbalsa/address-book-gpe.c:  fix InternerAddress regression.
	* libbalsa/source-viewer.c: do not expand menu (regression fixed).
	* libbalsa/imap/imap-commands.c: enable/disable IDLE.
	* libbalsa/imap/imap-{handle,search}.c: ditto.
	* libbalsa/imap/imap_private.h: add IDLE related fields.

2005-01-29  Pawel Salek

	* configure.in: do it by the book (literally).
	* libbalsa/address-book-extern.c: remove uneeded GNOME dependency.
	* libbalsa/*.c: ditto.
	* libinit_balsa/*.c: Druid needs GNOME.
	* src/balsa-app.c: remove BALSA_MAJOR <2 remains.
	* src/print.c: drop old gnomeprint-1.* support.

2005-01-29 09:23  PeterB

	* src/folder-conf.c: fix typo.

2005-01-28 08:44  Craig Routledge <webstuff at craigroutledge dot com>

	* libbalsa/mailbox_local.c: fix bug #147380.

2005-01-27  Pawel Salek

	* libbalsa/address-book-ldap.c: fix InternerAddress regression.

2005-01-22  Pawel Salek

	* libbalsa/mailbox_imap.c: do not loose content type paramters -
	fix message wrapping on replying.

2005-01-20  Pawel Salek

	* libbalsa/address-entry.c: fix crashes on: domain-expanded
	address selection; unparsable address.

2005-01-17 23:02  PeterB

	* src/: balsa-message.c, sendmsg-window.c: port from
	GtkFileSelection to GtkFileChooserDialog.

2005-01-17 18:14  Albrecht Dreß <albrecht.dress@arcor.de>

	* src/balsa-message.c, libbalsa/misc.c, libbalsa/misc.h: multiline
	URL highlighting.

2005-01-17  Pawel Salek

	* libbalsa/address-entry.c: add missing #include.
	* libbalsa/identity.h: 
	* libinit_balsa/balsa-druid-page-user.c: port it to InternetAddress.

2005-01-17 14:32  PeterB

	* libbalsa/address-entry.c: use list->address instead of
	internet_address_list_get_address.

2005-01-17 13:41  PeterB

	* src/balsa-message.c, src/message-window.c, src/print.c,
	src/save-restore.c, src/sendmsg-window.c, src/store-address.c,
	libbalsa/abook-completion.c, libbalsa/abook-completion.h,
	libbalsa/address-book-ldif.c, libbalsa/address-book-vcard.c,
	libbalsa/address-entry.c, libbalsa/address-entry.h,
	libbalsa/address.c, libbalsa/address.h, libbalsa/body.h,
	libbalsa/files.h, libbalsa/filter.c, libbalsa/identity.c,
	libbalsa/identity.h, libbalsa/libbalsa.h,
	libbalsa/libbalsa_private.h, libbalsa/mailbox.c,
	libbalsa/mailbox.h, libbalsa/mailbox_imap.c,
	libbalsa/mailbox_local.c, libbalsa/mailbox_mbox.c,
	libbalsa/message.c, libbalsa/message.h, libbalsa/misc.c,
	libbalsa/misc.h, libbalsa/send.c: use GMime's InternetAddress
	instead of LibBalsaAddress, except for address-book entries.

2005-01-17 10:36  PeterB

	* src/: toolbar-factory.c, toolbar-prefs.c: remove redundant
	includes.

2005-01-14 08:32  PeterB

	* configure.in, images/Makefile.am, src/balsa-message.c,
	src/expand-alias.c, src/expand-alias.h, src/sendmsg-window.c,
	images/mimetypes/Makefile, images/mimetypes/Makefile.am,
	images/mimetypes/Makefile.in,
	images/mimetypes/gnome-mime-application-pgp-signature.png,
	images/mimetypes/gnome-mime-application-pkcs7-mime.png,
	images/mimetypes/gnome-mime-application-pkcs7-signature.png,
	images/mimetypes/gnome-mime-application-x-pkcs7-signature.png,
	images/mimetypes/gnome-mime-message-disposition-notification.png,
	images/mimetypes/gnome-mime-message-external-body.png,
	images/mimetypes/gnome-mime-message.png,
	images/mimetypes/gnome-mime-multipart-alternative.png,
	images/mimetypes/gnome-mime-multipart-encrypted.png,
	images/mimetypes/gnome-mime-multipart-signed.png,
	images/mimetypes/gnome-mime-multipart.png: install mime type icons;
	simplify icon search.

2005-01-13 14:56  PeterB

	* configure.in, libbalsa/address-entry.c, libbalsa/address-entry.h,
	libbalsa/files.c, libbalsa/identity.c, libbalsa/mailbox.c,
	libbalsa/misc.c, libbalsa/misc.h, libbalsa/send.c,
	libbalsa/source-viewer.c, libinit_balsa/helper.c, src/Makefile.am,
	src/ab-main.c, src/ab-window.c, src/balsa-app.c, src/balsa-index.c,
	src/balsa-mblist.c, src/filter-edit-callbacks.c,
	src/filter-edit-dialog.c, src/filter-edit.h, src/mailbox-conf.c,
	src/main-window.c, src/main.c, src/pref-manager.c,
	src/sendmsg-window.c, src/sendmsg-window.h, src/store-address.c,
	src/toolbar-factory.c: require gtk+-2.0 >= 2.4 and remove
	GTK_CHECK_VERSION(2,4,0) tests.

2005-01-12  Pawel Salek

	* libbalsa/imap/imap-commands.c: work around broken dovecot indexes.

2005-01-07 09:47  PeterB

	* src/main-window.c: Use hyphen instead of underscore in translator
	credits.
	* src/balsa-mblist.c: restore separator in
	balsa_mblist_mru_option_menu(); remove unused variable.

2005-01-07  Pawel Salek

	* libbalsa/libbalsa.h: add mailbox manipulation error codes.
	* libbalsa/mailbox_imap.[hc]: return more info on error.
	* src/folder-conf.c: handle errors better.
	* src/mailbox-conf.c: ditto.

2005-01-06  Pawel Salek

	* libbalsa/imap/imap-handle.c: silence debugging output.
	* libinit_balsa/balsa-druid-page-user.[hc]: port initial wizard
	improvements.
	* src/balsa-mblist.c: protect against D&D crashes.

2005-01-05 09:05  PeterB

	* libbalsa/mailbox_local.c: use second GNode tree in jwz-threading.

2005-01-04  Pawel Salek

	* libbalsa/mailbox_local.c: remove bogus test from msg matching (PB).

2005-01-03 19:09  PeterB/manu <eallaud@yahoo.fr>

	* libbalsa/mailbox_local.c: check for NULL msg-id.

2006-01-02  Pawel Salek

	* libbalsa/filter.c, libbalsa/misc.[hc]: move in_string_utf8() to misc
	* libbalsa/libbalsa_private.h:
	* libbalsa/mailbox.c: move LibBalsaMailboxEntry def to private.h
	* libbalsa/mailbox_local.c: implement faster searching code
	(manyfold speedup for large mailboxes).

2004-12-31 12:08  Albrecht Dreß <albrecht.dress@arcor.de>

	* libbalsa/body.h, libbalsa/files.c, libbalsa/files.h,
	libbalsa/send.c, src/balsa-message.c, src/print.c,
	src/sendmsg-window.c, src/pixmaps/info_lock.xpm,
	src/pixmaps/info_lock_bad.xpm, src/pixmaps/info_lock_encr.xpm,
	src/pixmaps/info_lock_good.xpm, src/pixmaps/info_lock_sigtrust.xpm:
	new attachment handling code.

2004-12-30 17:04  PeterB

	* libbalsa/: mailbox.c, mailbox.h, mailbox_local.c: reduce the
	amount of tree modification when updating threading.
	* libbalsa/send.c: convert file name to utf-8 for GMime.

2004-12-29 11:49  PeterB

	* src/main-window.c: use BALSA_PIXMAP_CLOSE_MBOX instead of
	GTK_STOCK_CLOSE for Close-mailbox menu item; use
	GTK_ICON_SIZE_BUTTON for notebook label close button.

2004-12-27 10:02  PeterB

	* libbalsa/files.c: do not bypass theme when mime-type and filename
	are both NULL.

2004-12-26 18:45  PeterB

	* libbalsa/body.c: g_mime_data_wrapper_write_to_stream() decodes
	the transfer-encoding--we must not.
	* libbalsa/files.c: look for themed mime-type icon.

2004-12-24  Pawel Salek

	* libbalsa/body.c: always call gdk_pixbuf_loader_close().
	* libbalsa/mailbox_pop3.c: do not try to move messages filtered
	out by procmail.

2004-12-22 13:25  Albrecht Dreß <albrecht.dress@arcor.de>

	* libbalsa/: body.c, mime.c: two minor gpg related fixes.

2004-12-20 12:33  PeterB

	* src/: balsa-index.c, balsa-index.h: re-implement
	balsa_index_{next,previous}_msgno.
	* src/message-window.c: save more menu items; use
	balsa_index_{next,previous}_msgno() to correctly manage menu item
	and button sensitivity.

2004-12-18  Pawel Salek

	* libbalsa/imap/imap-handle.c: forgive errors in BODYSTRUCTURE response
	(work around #160083).

2004-12-18  Craig Routledge
	
	* src/balsa-app.[ch]: add mw_action_after_move.
	* src/message-window.c: use it.
	* src/pref-manager.c: configure it.
	* src/save-restore.c: save/restore it.

2004-12-16 14:34  PeterB

	* libbalsa/body.c: if body->mime_part is a GMimeMessagePart, get
	the stream for its message, not the part.

2004-12-15 06:43  PeterB

	* libbalsa/body.c: add some checks.

2004-12-13 09:41  PeterB

	* libbalsa/html.c: do not write zero bytes, to avoid a
	gtkhtml-CRITICAL.

2004-12-12 12:23  PeterB

	* libbalsa/mailbox_imap.c: check for NULL handle.

2004-12-09 15:45  PeterB

	* libbalsa/address-entry.c, libbalsa/address-entry.h,
	src/sendmsg-window.c: implement libbalsa_address_entry_addresses()
	and use it to move address-counting to libbalsa.

2004-12-08 15:11  PeterB

	* libbalsa/address.c: use InternetAddress methods to manage quoting
	and stringifying.
	* libbalsa/address-entry.c: use a hash table to hold
	LibBalsaAddress objects; parse quoted strings more carefully.

2004-12-07 18:57  PeterB

	* src/sendmsg-window.c: use libbalsa_wrap_rfc2646() to ensure
	space-stuffing.
	* libbalsa/misc.c: append spaces for DelSp=Yes.
	* libbalsa/gmime-gpgme-context.h: replace GMIME_CHECK_* macros with
	G_TYPE_*.
	* libbalsa/mailbox_mbox.c: simplify From_ line armoring.

2004-12-06 16:23  PeterB

	* libbalsa/: address.c, address.h: parse string with group address;
	implement libbalsa_address_set_copy_member() to make a copy of a
	LibBalsaAddress containing only one mailbox.
	* libbalsa/address-entry.c: parse entry text with group address;
	make only one completion item per address.
	* libbalsa/address-book-vcard.c: when not in dist_list_mode and a
	completion item has more than one address, make multiple
	single-address LibBalsaAddress objects.
	* libbalsa/: address.c, address.h, message.c: implement and use
	libbalsa_address_new_list_from_gmime(); do not ignore RFC 2822
	group addresses.

2004-12-04 08:39  PeterB

	* src/: balsa-index.c, balsa-index.h, message-window.c: remove
	balsa_index_next_.*_msgno api; implement balsa_index_select() and
	use it to manage highlighting in the mailbox index.

2004-12-02 11:19  PeterB

	* libbalsa/address-entry.c: connect to detailed signal.
	* libbalsa/mailbox_imap.c: return error from
	libbalsa_mailbox_imap_fetch_structure() on protocol error in
	imap_mbox_handle_fetch_range().

2004-12-01 21:23  PeterB

	* src/: balsa-message.c, message-window.c: use error return from
	libbalsa_message_body_ref() better.
	* src/balsa-message.c: check for NULL sig_body.
	* libbalsa/misc.c, libbalsa/misc.h, src/main-window.c,
	src/main-window.h, src/message-window.c, src/sendmsg-window.c: move
	libbalsa_window_select_all to src/main-window.c and rename; use
	balsa_index_update_tree() to expand all threads in
	balsa_window_select_all()--it blocks the "row-expanded" signal.
	* libbalsa/mailbox_maildir.c: issue message instead of warning on
	unanticipated flag change.
	* src/balsa-index.c: block "selection-changed" signal while
	collapsing all threads.

2004-11-30 19:57  PeterB

	* libbalsa/misc.c: for a GtkTreeView, expand-all before select-all.

2004-11-28 16:55  PeterB

	* src/sendmsg-window.c: drag'n'drop now passes the BalsaIndex of
	the source messages.
	* libbalsa/mime.c: body-ref the message in content2reply.

2004-11-24 07:02  PeterB

	* libbalsa/address-entry.c: do not set up completions before widget
	is realized.
	* libbalsa/address-entry.c: ...but do parse the entry text.

2004-11-23 20:31  PeterB

	* src/balsa-message.c: do not check mailbox when selecting message
	part.
	* libbalsa/: mailbox_maildir.c, mailbox_maildir.h: invalidate
	cached modification time when adding a message; don't check tmpdir.
	* libbalsa/mailbox_maildir.c: more careful caching of subdir
	mod-times.
	* libbalsa/mailbox.c: allow changing pseudo-flags in read-only
	mailbox.

2004-11-22 19:31  PeterB

	* src/balsa-app.c: make use of recursive gdk_threads_*; check
	whether balsa_app.mblist_tree_store has been finalized.
	* libbalsa/imap/pop3.c: double-check pop->sio before destroying.

2004-11-21 15:14  PeterB

	* src/: balsa-index.c, balsa-index.h: catch "row-collapsed" events;
	check for "next message" on expand and collapse events.
	* src/sendmsg-window.c: don't use
	libbalsa_address_entry_show_matches when NEW_ADDRESS_ENTRY_WIDGET
	is undefined.
	* configure.in: use enableval, not withval, with --enable-* option.

2004-11-20  Pawel Salek

	* NEWS, configure.in: modify for balsa-2.2.6 release.
	* balsa.spec.in: prefer "our" gmime when building package.

	* libbalsa/mailbox_imap.c: avoid crash when serializing partially
	constructed ImapMessages.
	* libbalsa/imap/imap-handle.c: ditto.
	* libbalsa/imap/auth-gssapi.c: revert last change,
	it breaks krb5-devel-1.3.4-7

2004-11-19 12:30  PeterB

	* libbalsa/: address-entry.c, address-entry.h: implement
	libbalsa_address_entry_show_matches, to force address completion
	with expensive address books.
	* src/sendmsg-window.c: make ctrl+R context-dependent--its action
	is now libbalsa_address_entry_show_matches when the focus widget is
	a GtkEntry.
	* src/balsa-index.c: check msgnos->len instead of
	index->selected->len before moving messages.

2004-11-17 18:18  PeterB

	* libbalsa/mailbox_mbox.c: use fstat instead of stat while mailbox
	is open.

2004-11-17  Pawel Salek

	* TRANSLATABLE_FILES: 
	* sounds/{Makefile.am,balsa.soundlist.in}:
	* src/main-window.c: consolidate sound lists #127751, Craig Routledge.
	* libbalsa/mailbox_imap.c: add content-type-encoding to cache files.
	* libbalsa/imap/auth-gssapi.c: include gssapi.h directly.
	* src/message-window.c: focus directly on message (#158514).

2004-11-17 09:16  PeterB

	* libbalsa/send.c: combine flag changes.
	* libbalsa/mailbox_mbox.c: be more careful with pseudo-flags; flush
	stream and save mtime after rewriting in place.
	* libbalsa/mailbox_maildir.c: be more careful with pseudo-flags.

2004-11-16 11:53  PeterB

	* src/expand-alias.c: utf8-aware entry matching.

2004-11-15 21:32  PeterB

	* libbalsa/misc.c, libbalsa/misc.h, libbalsa/send.c,
	src/pref-manager.c, src/sendmsg-window.c: organize character sets
	in libbalsa_codeset_info[]; implement and use LibBalsaTextAttribute
	enum and libbalsa_text_attr_{file,string}; implement and use
	libbalsa_charset_button_new(); check file character set at attach
	time instead of send time.
	* libbalsa/mailbox.c: check when opening an already open mailbox.

2004-11-11 07:29  PeterB/Pawel

	* src/balsa-message.c: deprecation cleanup.

2004-11-10  Pawel Salek

	* src/balsa-index.c: search for "To" field in sentbox-type mailboxes.
	* src/balsa-mblist.c: ditto (Emmanuel Allaud).
	* src/main-window.[hc]: update the label apriopriately.
	* src/sendmsg-window.c: report signature errors if any.

2004-11-10 16:33  PeterB

	* libbalsa/address-entry.c: show matches for all mailboxes in an
	address.

2004-11-09  Pawel Salek

	* libbalsa/imap/imap-handle.c: return '\0' as the delimiter
	when server responds NIL (exposed by UW-IMAP 2004a).
	* src/mailbox-node.c: ditto.
	* libinit_balsa/init_balsa.c: dismiss the wizard when main window
	is ready.

2004-11-08  Pawel Salek

	* src/mailbox-conf.c: do not crash on POP3 mailbox update.
	* src/mailbox-node.c: do not complain loudly on finding non-mailboxes.

2004-11-07  Pawel Salek

	* libbalsa/address-book-{extern,gpe,ldap}.c: fix crashes in ::complete.

2004-11-07 14:07  PeterB

	* src/balsa-mblist.c: make balsa_app.mblist_tree_store a weak
	pointer, so we can detect when it has been destroyed.
	* src/main-window.c: provide a localizable tooltip for Reset
	_Filter menu item, and change its shortcut to _Reset Filter; add
	shortcut _Select All.
	* src/sendmsg-window.c: fix bug 156460--replace EUC-JP with
	ISO-2022-JP for Japanese language option.

2004-11-07 10:54  manu <eallaud@yahoo.fr>

	* libbalsa/mailbox_imap.c, src/ab-window.c, src/pref-manager.c:
	build with GTK_VERSION < 2.4.0.

2004-11-05  Carlos Morgado  <chbm gnome.org>

	* libbalsa/abook-completion.c: fix segfault on strncmp_word
	(glibc strncmp is sucking)

2004-11-06 09:41  PeterB

	* libbalsa/: abook-completion.c, abook-completion.h,
	address-book-extern.c, address-book-extern.h, address-book-ldif.c,
	address-book-ldif.h, address-book-vcard.c, address-book-vcard.h,
	address-entry.c: match user input at start of any word in key;
	use a single GCompletion with a key consisting of full_name,
	nick_name, and all mailboxes, space-separated; utf8_normalize
	and utf8_casefold all strings.

2004-11-05 20:31  PeterB

	* libbalsa/identity.c: build with GTK_VERSION < 2.4.0.
	* src/sendmsg-window.c: toggle button is now a GtkToggleToolButton.
	* libbalsa/address-entry.c: store only the current matches.
	* libbalsa/address-entry.c: copy address from src to dest(!).

2004-11-04 Albrecht Dreß <albrecht.dress@arcor.de>

	* libbalsa/: address-book-vcard.c, address-entry.c: small patch to
	address two utf8 related problems.

2004-11-04 17:07  PeterB

	* libbalsa/address-entry.c: do not pop down completions on
	receiving focus--it can be annoying.
	* libbalsa/address-entry.c: do not dequote address phrase.

2004-11-03 21:46  PeterB

	* libbalsa/address-entry.c: pop down completions on receiving
	focus.
	* libbalsa/address-entry.c: update completion list on cursor
	movement.
	* libbalsa/address-entry.c: test for NULL name; clean up completion
	list.
	* src/expand-alias.c, src/expand-alias.h, src/main.c,
	src/sendmsg-window.c, libbalsa/address-entry.c,
	libbalsa/address-entry.h: reimplement LibBalsaAddressEntry using
	GtkEntryCompletion.

2004-11-02 15:30  PeterB

	* src/ab-window.c: connect to "changed" signal after initializing
	the combo-box.
	* libbalsa/address.c: be more careful with address list.
	* src/sendmsg-window.c: ditto.

2004-10-31 15:47  PeterB

	* src/toolbar-factory.c: toggle button is now a
	GtkToggleToolButton.

2004-10-30 11:37  PeterB

	* src/main.c: destroy balsa_threads_mutex on exit.

2004-10-29 15:11  PeterB

	* src/ab-main.c: restore address book radio button mnemonics.
	* src/main-window.c, libbalsa/mailbox_mbox.c: check for corrupt
	mbox when opening and when adding a message, and check return value
	from open.

2004-10-27 20:14  PeterB

	* src/Makefile.am: define lots of *_DISABLE_DEPRECATED symbols.
	* src/ab-main.c: migrate from deprecated GtkItemFactory to
	GtkUIManager.
	* src/toolbar-factory.c: do not use deprecated parts of the
	GtkToolbar api.
	* src/toolbar-prefs.c: plug leak.
	* src/store-address.c: migrate from deprecated GtkOptionMenu to
	GtkComboBox.
	* src/pref-manager.c: migrate from deprecated GnomeFontPicker,
	GnomeColorPicker, and GtkOptionMenu to GtkFontButton,
	GtkColorButton, and GtkComboBox.

2004-10-26 06:48  PeterB

	* libbalsa/: address-book-extern.c, address-book-ldif.c,
	address-book-vcard.c, address-book.c, address.c, body.c, files.c,
	filter-error.c, filter-file.c, filter.c, identity.c, imap-server.c,
	libbalsa.c, mailbox-filter.c, mailbox.c, mailbox_imap.c,
	mailbox_local.c, mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c,
	mailbox_pop3.c, message.c, mime.c, misc.c, rfc3156.c, send.c,
	server.c: include only documented Gnome header files, where
	possible.
	* libbalsa/source-viewer.c: GtkAction port is not a deprecation
	issue--make it conditional on USE_GTK_ACTION.

2004-10-25 12:59  PeterB

	* src/: filter-edit-callbacks.c, filter-edit-dialog.c: populate
	list of user headers.
	* src/mailbox-conf.c: migrate mailbox-conf dialogs from deprecated
	GtkOptionMenu to GtkComboBox; replace last HAVE_GTK24 with
	GTK_CHECK_VERSION.
	* src/information-dialog.c: use g_strdup.
	* src/: filter-edit-callbacks.c, filter-edit-dialog.c,
	filter-edit.h: migrate filter edit dialogs from
	deprecated GtkCombo to GtkComboBoxEntry, and from deprecated
	GtkOptionMenu to GtkComboBox.
	* src/filter-run-callbacks.c, libbalsa/mailbox.c: plug memory
	leaks.

2004-10-23 12:13  PeterB

	* src/balsa-mblist.c: migrate BalsaMBListMRUOPtionMenu from
	deprecated GtkOPtionMenu to GtkComboBox.
	* libbalsa/: filter-file.c, mailbox_imap.c, mailbox_mbox.c: compile
	without threads.

2004-10-22 20:14  PeterB

	* src/balsa-index.c: restore cursor when current message is
	exposed.
	* src/balsa-index.c: don't blank preview when thread is collapsed;
	be more careful when thread is expanded.
	* src/balsa-index.c: take care not to lose current message; use
	binary search to find msgno in array.

2004-10-21 19:51  PeterB

	* src/main.c: implement recursive gdk_threads_{enter,leave}.
	* libbalsa/: Makefile.am, abook-completion.c,
	address-book-extern.c, address-book-extern.h, address-book-ldif.c,
	address-book-ldif.h, address-book-vcard.c, address-book-vcard.h,
	address-book.c, body.c, files.c, filter-file.c, filter.c, html.c,
	identity.c, information.c, libbalsa.c, mailbox.c, mailbox_imap.c,
	mailbox_mbox.c, mailbox_mh.c, message.c, rfc3156.c, rfc3156.h,
	send.c, source-viewer.c: deprecation cleanup.
	* src/ab-window.c: ditto.

2004-10-21 Albrecht Dreß <albrecht.dress@arcor.de>

	* libbalsa/Makefile.am, libbalsa/gmime-application-pkcs7.c,
	libbalsa/gmime-application-pkcs7.h,
	libbalsa/gmime-gpgme-signature.c, libbalsa/gmime-gpgme-signature.h,
	libbalsa/gmime-part-rfc2440.h, libbalsa/rfc3156.c,
	src/balsa-message.c, src/print.c, configure.in: a first
	implementation of the S/MIME (RFC 2633) crypto protocol for
	Balsa 2.2 is ready.

2004-10-20  Pawel Salek

	* libbalsa/address.[hc]: try to slowly phase out MIDDLE_NAME
	- it has very limited usefullness.
	* src/ab-window.c: do not clutter UI with one-element address book list
	* src/store-address.c: ditto.

2004-10-19  Pawel Salek

	* libbalsa/filter.c: display information provided by GError.
	* libbalsa/libbalsa.h: add new error codes.
	* libbalsa/mailbox.[ch]: copy() and add_message provide more info
	on error.
	* libbalsa/mailbox_imap.c: set GError.
	* libbalsa/mailbox_{maildir,mh}.c: ditto.
	* libbalsa/mailbox_mbox.c: ditto. Fix rewind bug in ::check().
	* libbalsa/mailbox_pop3.c: do not leave messages around. More
	thourough error checking: do not remove messages from server when
	save fails.
	* libbalsa/send.c: adapt to changed LibBalsaMailbox API.
	* src/balsa-index.c: report more info on error.

2004-10-19 18:26  PeterB

	* src/main-window.c: more accurate and informative progress dialog
	label.
	* src/balsa-app.c: remove assertion.

2004-10-17 15:37  PeterB

	* src/balsa-index.c: unref the message when clearing/changing
	index->current_message, and do not use weak refs.

2004-10-16 08:55  PeterB

	* src/: balsa-index.c, balsa-index.h: set
	LIBBALSA_MESSAGE_FLAG_SELECTED user flag to block message from
	being filtered out of the view; handle selecting deleted message;
	use BalsaIndex::search_iter when possible.
	* libbalsa/: mailbox.c, mailbox_imap.c, mailbox_maildir.c,
	mailbox_mbox.c, mailbox_mh.c, message.h: implement
	LIBBALSA_MESSAGE_FLAG_SELECTED user flag, manage it in backends,
	and test it before filtering message out of the view.
	* libbalsa/filter.c: do not call
	libbalsa_mailbox_search_iter_free--view filtering is now managed by
	mailbox code.
	* libbalsa/body.c: check for NULL body.

2004-10-15 15:06  PeterB

	* src/main-window.c: add mnemonics for next/previous part menu
	items.
	* src/message-window.c: manage sensitivity of next/previous part
	controls, and of move-to-trash controls.
	* src/: balsa-message.c, balsa-message.h, main-window.c: manage
	sensitivity of next/previous part controls.
	* src/balsa-message.c: test for missing body_list.
	* src/main-window.c: allow remote trashbox to be emptied.

2004-10-14 22:34  PeterB

	* libbalsa/mailbox.c, libbalsa/mailbox.h, src/save-restore.c: use
	consistent date formats.

2004-10-12 12:32  PeterB

	* src/: balsa-mblist.c, main-window.c: be careful in drag'n'drop
	callback.

2004-10-11 15:18  PeterB

	* libbalsa/: filter.c, filter.h: implement
	libbalsa_condition_is_flag_only.
	* libbalsa/mailbox.c: catch runaway
	libbalsa_mailbox_search_iter_step; use
	libbalsa_condition_is_flag_only.

2004-10-11 14:55  Craig Routledge <webstuff@craigroutledge.com>

	* src/: balsa-icons.c, balsa-icons.h, message-window.c,
	toolbar-factory.c, pixmaps/balsa_next_part.xpm,
	pixmaps/balsa_previous_part.xpm, pixmaps/menu_next_part.xpm,
	pixmaps/menu_previous_part.xpm: Adds several accelerators and
	next/previous message to message window.

2004-10-11 14:54  PeterB

	* src/: balsa-index.c, balsa-index.h: implement
	balsa_index_{next,previous,next_unread,next_flagged}_msgno for
	message window's use.

2004-10-10  Pawel Salek

	* libbalsa/mailbox_imap.c: first shot at systematic ImapCacheManager
	+ do not fetch headers twice.
	* libbalsa/imap/imap-commands.c: do not fetch headers twice.
	* libbalsa/imap/imap-handle.[hc]: header cache serialize support.
	* libbalsa/imap/libimap.h: ditto.
	* bootstrap.sh: check automake result.

2004-10-08 11:27  PeterB

	* src/: balsa-mblist.c, main-window.c: check whether Balsa has
	quit while checking mail.
	* libbalsa/imap/imap-commands.c: plug leak.

2004-10-06 15:20  PeterB

	* src/: sendmsg-window.c, sendmsg-window.h: change "From:" address
	widget from LibBalsaAddressEntry to GtkComboBox.

2004-10-06 05:18  jensgr@gmx.net (Jens Granseuer)

	* libbalsa/send.c: remove X-Balsa-Fcc header when using sendmail
	backend.

2004-10-05 12:49  PeterB

	* src/main-window.c: check that message still has a mailbox before
	trying to display it.

2004-10-05  Amanpreet Singh Alam<amanpreetalam@yahoo.com>
	
	* configure.in: pa (Punjabi Language entey made) 

2004-10-04 16:39  PeterB

	* libbalsa /: mailbox.c, mailbox.h: implement new _msgno_has_flags
	subclass method; scrap old _change_message_flags method;
	lock mailbox in libbalsa_mailbox_messages_move; scrap
	libbalsa_mailbox_messages_status_changed.
	* libbalsa/mailbox_imap.c: implement new _msgno_has_flags
	subclass method; scrap old _change_message_flags method;
	replace libbalsa_mailbox_messages_status_changed update of
	unread_messages.
	* libbalsa/mailbox_local.c: check for possible loop in simple
	threading.
	* libbalsa/: mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c:
	implement new _msgno_has_flags subclass method; add subclass
	methods for current _messages_change_flags method; scrap old
	_change_message_flags method.
	* libbalsa/mailbox_pop3.c: use mailbox+msgno methods.
	* libbalsa/: message.c, message.h: scrap
	libbalsa_messages_{copy,move}.
	* libbalsa/send.c: use libbalsa_mailbox_messages_change_flags
	instead of libbalsa_messages_change_flag.
	* src/: balsa-index.c, balsa-index.h: new balsa_index_transfer api;
	change BalsaIndex::selected from GList of messages to Garray of
	msgnos; use mailbox+msgno methods; new drag&drop convention.
	* src/balsa-mblist.c: use new balsa_index_transfer api; use new
	drag&drop convention.
	* src/main-window.c: use new api for balsa_index_transfer; fix
	drag&drop to notebook tab; use mailbox+msgno method to empty trash.
	* src/message-window.c: use new api for balsa_index_transfer.

2004-10-04  Pawel Salek

	* libbalsa/imap/imap-handle.c: fix bug in flag cache update on
	expunge.

2004-10-03  Pawel Salek

	* libbalsa/mailbox_imap.c: use cached flags.
	* libbalsa/imap/imap-commands.[hc]: implement 
	imap_mbox_handle_msgno_has_flags().
	* libbalsa/imap/imap-handle.[hc], imap_private.h: cache flags.
	* libbalsa/imap/imap-search.c: optimize flag-only searches
	to use cached flags.

2004-10-02  Pawel Salek

	* NEWS, configure.in: release 2.2.5
	* libbalsa/rfc3156.c: correct invalid signature warning.

2004-10-01 10:03  PeterB

	* libbalsa/mailbox_mbox.c: must test g_mime_parser_eos while
	parsing, not g_mime_stream_eos.

2004-10-01  PeterB

	* src/main-window.c: sensitize expand/collapse all.

2004-09-30 13:48  PeterB

	* src/mailbox-node.c: do not connect twice to the
	"show-prop-dialog" signal.

2004-09-29 19:32  PeterB

	* src/balsa-mblist.c: don't check for click in expander column.
	* libbalsa/imap/imap-handle.c: larger buffer for section
	specification.
	* libbalsa/send.c: remove status headers before sending; clear NEW
	and FLAGGED flags in fcc copies.

2004-09-29 19:25  Albrecht Dreß <albrecht.dress@arcor.de>

	* src/balsa-message.c: if a '3156 signature is additionally wrapped
	into the "-----BEGIN PGP MESSAGE-----" armor, it is passed into the
	'2440 check routine, which in turn destroys the original
	verification result--plugged.

2004-09-29  Pawel Salek

	* libbalsa/address-book-ldap.c: compare result with LDAP_OPT_SUCCESS
	* libbalsa/mailbox.[hc]: add capability query function (until
	client side IMAP sorting and threading is implemented).
	* libbalsa/mailbox_imap.c: add its implementation.
	* libbalsa/send.c: change flags more carefully.
	* src/folder-conf.c: "Show INBOX" was not saved on edition due to
	incorrect statement order.
	* src/main-window.c: touch-ui fixes.
	* src/save-restore.c: do not crash on corrupted config.

2004-09-28 13:58  Albrecht Dreß <albrecht.dress@arcor.de>

	* src/balsa-message.c: fix one line dropped in commit.

2004-09-28 10:54  PeterB

	* libbalsa/mailbox_mbox.c: use g_mime_object_get_header to verify
	header offsets; use offset of MIME-Version header, if any, as
	insertion point for status headers, if needed.
	* libbalsa/mailbox_mbox.c: be more careful when locating Status and
	X-Status headers.

2004-09-26 11:14  PeterB

	* libbalsa/source-viewer.c: fix broken select-text and copy-text.

2004-09-25 09:48  Albrecht Dreß <albrecht.dress@arcor.de>

	* src/balsa-message.c: check info->widget != NULL.

2004-09-25 05:26  PeterB

	* libbalsa/gmime-gpgme-context.c: use ctx->micalg as the hash name
	when the hash is GMIME_CIPHER_HASH_DEFAULT.

2004-09-24 21:47  PeterB

	* libbalsa/body.c: make inline the default content-disposition for
	message/rfc822, instead of forcing creation of content-disposition
	header--that breaks crypto.
	use content-type "text/plain" when body->content_type is NULL.

2004-09-21  Pawel Salek

	* doc/C/balsa.xml: identity doc update from Craig Routledge.
	* libbalsa/mailbox_imap.c: handle smoothely imaps servers
	disconnecting on every FETCH response (yes, they exists!).
	* libbalsa/message.c: set the charset correctly for embedded
	messages fetched from imap.
	* libbalsa/imap/imap-commands.c: send exist-notify on failed re-select.
	* src/print.c: signature printing from Albrecht Dreß.

2004-09-16  Pawel Salek

	* libbalsa/imap/imap-commands.c: Improve heuristics in fetching HEADER.

2004-09-15  Pawel Salek

	* libbalsa/imap-server.c: do not call g_strdup_printf() with null arg.
	* libbalsa/mailbox_imap.c: more verbose on large messages.
	* libbalsa/mailbox_mbox.c: rollback on error instead of leaving
	mailbox in a corrupted state.
	* libbalsa/imap/imap-commands.c: save one RTT. Use .MIME better.
	* libbalsa/imap/imap-handle.c: handle BODY[HEADER] response.
	* src/balsa-mblist.c: assure minimal size of the mailbox selection
	widget.

2004-09-11 17:30  PeterB

	* libbalsa/send.c: use GMimeMessagePart for an attached message.
	* libbalsa/: mailbox_imap.c, imap/imap-commands.c,
	imap/imap-handle.c: use "FETCH %u BODY[%s.MIME]" to fetch part
	headers verbatim; fetch complete multipart/signed and
	multipart/encrypted parts.

2004-09-11 Albrecht Dreß <albrecht dot dress at arcor dot de>

	* src/balsa-icons.c, src/balsa-icons.h, src/balsa-message.c,
	src/mailbox-conf.c, src/save-restore.c, libbalsa/mailbox.c,
	libbalsa/mailbox.h, src/pixmaps/balsa_gpg_recheck.xpm:
	- reorganise the crypto calls in src/balsa-message.c into only
	one function to simplify the treatment of (in particular, but not
	only imap) messages;
	- make the automatic crypto ops user-configurabe on a per-mailbox
	basis;
	- add a button to manually force checking/decryption of a message;
	- implement proper handling of enigmail multipart/encrypted messages.

2004-09-10  Pawel Salek

	* libbalsa/address-entry.[hc]: make fill_input() public.
	* src/sendmsg-window.c: use it.
	* libbalsa/send.c: remove x-balsa-fcc from sent messages.

2004-09-09 08:49  PeterB

	* src/: pref-manager.c, save-restore.c: auto-expunge timeout in
	minutes instead of hours.
	* src/: balsa-index.c, main-window.c: update the mailbox's last_use
	time stamp only on expose/conceal and changing a deleted flag, not
	on other mailbox changes.
	* src/balsa-message.c: hide widget while empty and while changing
	it.
	* libbalsa/mailbox_imap.c: do not fetch expunged message.
	* src/balsa-index.c, src/main-window.c, libbalsa/send.c: use
	gdk_display_flush if available, instead of gdk_flush.

2004-09-08  Pawel Salek

	* src/message-window.c: change defaults for touch-ui build.
	* libbalsa/address-book-gpe.c: armour against persons with
	multiple addresses.

2004-09-07  Pawel Salek

	* libbalsa/send.c: make the error messages match reality.
	* src/balsa-index.c: disable tree view searching conflicting with
	shortcuts.
	* src/sendmsg-window.[ch]: unregister identities listener (crash).
	* src/folder-conf.c: bug workaround disabled by default.

2004-09-07 08:05  PeterB

	* src/balsa-message.c: remove assertion; do not set charset--now
	handled by all backends.
	* libbalsa/message.c: avoid casts.
	* libbalsa/mailbox_imap.c: set content type before caching part.

2004-09-06 12:11  PeterB

	* src/balsa-message.c: check mailbox only if we are displaying a
	new part.
	* libbalsa/mailbox_imap.c: fix from Pawel for content-type/charset
	breakage from yesterday's commit.

2004-09-05 17:13  PeterB

	* libbalsa/: body.c, body.h: new methods
	libbalsa_message_body_get_{stream,content,pixbuf} avoid using
	temporary file.
	* libbalsa/: message.c, message.h: new api for
	libbalsa_message_get_part_by_id, returns a GMimeStream instead of a
	FILE handle.
	* libbalsa/html.c, libbalsa/mime.c, src/balsa-message.c,
	src/print.c: use new and modified methods.
	* libbalsa/misc.c: downgrade warning to message.

2004-09-04  Pawel Salek

	* libbalsa/imap-server.c: set timeout to 30s.
	* libbalsa/mailbox_imap.c: handle missing envelopes gracefully.
	* src/balsa-index.c: ditto. Do not overwrite error msg.
	* libbalsa/send.c: fix mispelling.
	* libbalsa/imap/imap-handle.[hc], imap_private.h: timeout setup.
	* libinit_balsa/balsa-druid-page-finish.c: fix regression
	introduced yesterday.

2004-09-03  Pawel Salek

	* libbalsa/address-book-gpe.c: more consistent behaviour (perhaps
	needs to be discussed).
	* libbalsa/mailbox_imap.c: detect and work around Exchange bugs
	explicitely.
	* libbalsa/imap/imap-{commands,handle}.c: set ::can_fetch_body.
	* libbalsa/imap/imap-handle.h: add ImapMboxHandle::can_fetch_body.
	* libinit_balsa/balsa-initdruid.c: quit on destroy signal.
	* src/expand-alias.c: expand addresses differently.
	* libbalsa/imap/auth-gssapi.c: compile against heimdal (#151753). 

2004-09-03 08:48  PeterB

	* src/balsa-message.c: leave vertical scrollbar in place while html
	widget is displayed.

2004-09-02  Pawel Salek

	Handle parts' content-id for imap mailboxes.
	* libbalsa/body.[hc]: add content-id field and use it.
	* libbalsa/mailbox_imap.c: set it.
	* libbalsa/imap/imap-handle.c: store received content id.
	* libbalsa/imap/libimap.h: ... in ImapBody field.
	* src/balsa-index.c: gtk-2.4.9 has FIXED_HEIGHT bugs fixed. Uff.

2004-09-02 05:15  PeterB

	* src/: balsa-message.c, balsa-message.h: leave room for vertical
	scrollbar when rendering html widget.

2004-09-01 08:35  PeterB

	* src/save-restore.c: change only hide-deleted bit in GUI filter.
	* src/: balsa-app.h, balsa-index.c, pref-manager.c, save-restore.c:
	drop balsa_app.hide_deleted; add_pref_menu and attach_pref_menu
	always use the same callback; implement default sort-field; update
	current views when the default is changed; use
	pm_page_add_to_size_group to align widgets.

2004-08-31 20:07  PeterB

	* src/message-window.c: check message->mailbox.
	* src/main-window.c: notify user about failure in balsa_message_set
	instead of here.
	* src/balsa-message.c: check mailbox when body-ref fails and before
	selecting a new part, and notify user.
	* src/balsa-index.c: check whether message has lost its mailbox.

2004-08-31 20:07  PeterB

	* libbalsa/mailbox.h: change fetch_message_structure api to return
	a gboolean success indicator.
	* libbalsa/: message.c, message.h: ditto; new name and api for
	libbalsa_message_load_envelope.
	* libbalsa/mailbox_mh.c: ditto; check for removed files; use new
	* api for libbalsa_message_load_envelope and ignore
	load_envelope errors.
	* libbalsa/mailbox_mbox.c: ditto; less draconian resync when
	mailbox is changed behind our back.
	* libbalsa/mailbox_maildir.c: ditto; drop msg_info->msgno; check
	for removed files; reorganize sync; use new api for
	libbalsa_message_load_envelope.
	* libbalsa/: mailbox_local.c, mailbox_local.h: ditto; rename
	_libbalsa_mailbox_local_get_{mime_message,message_stream}.
	* libbalsa/mailbox_imap.c: ditto; implement sorting with threaded
	views.
	* libbalsa/mailbox.c: ditto; change default sort-field to
	LB_MAILBOX_SORT_NO.

2004-08-31  Pawel Salek

	* libbalsa/message.h, send.h: order sending related declarations.
	* libbalsa/misc.c: do not get wrapping confused by '\r'.
	* libbalsa/send.c: move messages to sentbox AFTER relaying.
	* src/balsa-app.[hc]: define balsa_find_sentbox_by_url().
	* src/balsa-mblist.c: GValue MUST be initialized.
	* src/balsa-message.c: avoid double-spacing for nonwrapped text.
	* src/main-window.c: changed sending API.
	* src/sendmsg-window.c: ditto.

2004-08-30  Pawel Salek

	* libbalsa/imap-server.[hc]: some infrastructure for server bugs
	workarounds (I do not really want to go there...)
	* libbalsa/mailbox{,_local}.c: move _release_message() from
	LibBalsaMailboxLocal to LibBalsaMailbox
	* libbalsa/mailbox_imap.c: reuse full message cache better.
	* src/{mailbox,folder}-conf.c: configure server bug workarounds.

2004-08-28  Pawel Salek

	* libbalsa/send.c: fix calls to smtp_header_set_option()
	(wrong since 2001-05-22).
	* libbalsa/address-book-gpe.c: handle MODIFIED tag.

2004-08-28  Pawel Salek

	* NEWS, configure.in: release 2.2.4
	* libbalsa/address-book-gpe.c: handle entries without addresses.
	* libbalsa/imap/imap-handle.c: cleanup.

2004-08-27  Pawel Salek

	* libbalsa/address-book-gpe.c: port fixes.
	* libbalsa/imap-server.h: remove dependency on libimap.h
	* libbalsa/mailbox_{imap,pop3}.[hc]: simplify API slightly.
	* libbalsa/send.c: send via smtp service by default.
	* libinit_balsa/balsa-druid-page-{directory,finish,user,welcome}.[hc]:
	new wizard.
	* libinit_balsa/helper.[hc]: implement add_table_option and checkbox.
	* src/print.c: set the parent of the warning window.

2004-08-27 08:22  PeterB

	* libbalsa/mailbox_mbox.c: clear unread message count when clearing
	the mailbox.

2004-08-26 16:48  PeterB

	* libbalsa/body.c, src/balsa-message.c: default content-disposition
	for text/plain is in-line; implement add_multipart_digest; both
	changes needed to display complete digests.
	* libbalsa/: mailbox_imap.c, mailbox_imap.h: use "imap://..." url
	even when server->use_ssl is set.
	* libbalsa/mailbox_mbox.c: be a little more careful when parsing.
	* src/balsa-index.c: re-expand thread when a message is added, if
	balsa_app.expand_tree is set; code for
	balsa_app.expand_to_new_unread in place but disabled.

2004-08-23 23:04  Pawel Salek

	* libbalsa/imap/imap-{commands,search}.c:Debian report #266298.
	* src/main-window.c: 
	* src/sendmsg-window.c: fix misspellings pointed out by Kelemen Gábor.
	* libbalsa/address-book-gpe.c: improve completion support.
	
2004-08-23 22:02  PeterB

	* libbalsa/server.c: form of "set-host" signal is conditional on on
	USE_SSL.
	* src/folder-conf.c: add weak pointer to avoid critical warning
	when Balsa exits with a folder-properties window open.
	* src/: folder-conf.c, mailbox-conf.c: connect new folder or
	mailbox to "set-host" signal so it can update its config info; call
	libbalsa_server_set_host after making other server changes, so
	folders and mailboxes update the config file correctly.

2004-08-23  Pawel Salek

	* src/address-book-config.c: fix my sloppy code in GPE config.
	* libbalsa/address-book-gpe.h: respect HAVE_SQLITE.
	* src/sendmsg-window.c: work around #150141.

2004-08-22  Pawel Salek

	* configure.in: add --with-sqlite option.
	* libbalsa/Makefile.am: add address-book-gpe.[hc] - support for
	GPE address book - http://gpe.handhelds.org/
	* libbalsa/libbalsa.c: register address book object.
	* libbalsa/mailbox_pop3.c: update progress dialog more frequently.
	* libbalsa/send.c: set default "Sending.." progress dialog size.
	* src/ab-main.c: register GPE address book object.
	* src/pref-manager.c: 
	* src/address-book-config.c: add GPE address book config.
	* src/balsa-app.h: more sensible default layout and fonts.
	* src/save-restore.c: ditto.
	* src/balsa-mblist.c: shorten column titles.
	* src/main-window.c: more cleanup for touch-ui.
	* src/main.c: fixes to -s option.

2004-08-22 13:27  PeterB

	* src/mailbox-node.c: steal the mailbox when moving a special
	mailbox from the top level to a newly scanned folder tree, and make
	sure its mailbox-node is connected to the "show-prop-dialog"
	signal.
	* src/balsa-app.c: steal the mailbox instead of the mailbox-node
	when removing a special mailbox.
	* src/: folder-conf.c, mailbox-conf.c, mailbox-conf.h: pass a list
	of default ports to be stripped from host string when use_ssl is
	toggled.
	* libbalsa/server.c: document libbalsa_server_connect_signals.
	* libbalsa/mailbox_imap.c: use INBOX as default path if config file
	does not provide one, and warn the user.

2004-08-21 12:34  PeterB

	* src/: mailbox-node.c, save-restore.c: keep config entries
	consistent for an IMAP folder and any mailboxes in its tree.

2004-08-20 08:31  PeterB

	* src/: folder-conf.c, mailbox-conf.c, mailbox-conf.h: strip port
	off host string when user toggles use_ssl.
	* libbalsa/mailbox_imap.c: jensgr@gmx.net (Jens Granseuer),
	statement order.

2004-08-20  Pawel Salek

	* libbalsa/mailbox_imap.c: work with MSExchange (no sort extension).
	* libbalsa/imap/Makefile.am: remove duplicated -Werror.
	* src/Balsa.idl: add getStats method.
	* src/main.c: -s option
	* src/balsa-bonobo.c: implement it.
	* src/balsa-app.[hc]: remove dead wood of line_length.
	* src/balsa-index.h, src/main-window.c:
	* src/pref-manager.c, src/save-restore.c: ditto.

2004-08-19 09:38  PeterB

	* libbalsa/mailbox_imap.c, libbalsa/server.c, libbalsa/server.h,
	src/mailbox-node.c, src/save-restore.c: really connect only once to
	server's "get-password" signal.
	* src/mailbox-node.c: connect only once to server's "get-password"
	signal.
	* libbalsa/mailbox_imap.c: allow subscribe and unsubscribe for a
	closed mailbox.

2004-08-18 14:33  PeterB

	* src/folder-conf.c: redraw row when descriptive name is changed.
	* src/mailbox-conf.c: handle name-change for special mailboxes when
	path is not changed.
	* src/main-window.c: verify balsa_app.mblist_tree_store in
	mail-check thread.
	* libbalsa/mailbox_imap.c: disconnect signal handler when
	finalizing mailbox.

2004-08-17 22:14  PeterB

	* src/: balsa-app.h, main.c, pref-manager.c, save-restore.c: make
	periodic expunge configurable.

2004-08-16  Pawel Salek

	* libbalsa/address-book.c: expand aliases by default.
	* libbalsa/mailbox_imap.c: handle better corner cases of
	concurrent mailbox access.

2004-08-16 13:20  PeterB

	* src/: balsa-message.c, pref-manager.c, sendmsg-window.c: plug
	widget leaks in popup menus.
	* libbalsa/mailbox_maildir.c: plug file descriptor leak; test for
	NULL return from libbalsa_mailbox_get_message_stream.
	* libbalsa/mailbox_mbox.c:
	* src/sendmsg-window.c: plug leaks.

2004-08-15  Pawel Salek

	* NEWS, configure.in: release 2.2.3.

2004-08-15  Albrecht Dreß

	* libbalsa/body.c, libbalsa/mailbox.[hc]:
	* libbalsa/mailbox_{imap,local}.c: avoid g_mime_part_get_content
	and GMmime bugs.
	* src/balsa-message.c: use changed API.

2004-08-15  Pawel Salek

	* libbalsa/filter-funcs.c: initialize structure (Manu).
	* libbalsa/mailbox_imap.c: reconnect on BYE, too.
	* libbalsa/imap/imap-handle.c: preserve BYE server message.

2004-08-14  Pawel Salek

	* libbalsa/address-book-ldap.c: cleanup v3 recognition and error
	reporting.
	* libbalsa/address-book-{vcard,ldif}.c: use filter parameter.
	* libbalsa/address.c: provide sensible edit widget for NULL address.
	* libbalsa/filter-funcs.c: plug leaks (Manu).
	* src/ab-main.c: next series of fixes.
	* src/sendmsg-window.c: D&D files to compose window.

2004-08-13 19:21  Albrecht Dreß <albrecht.dress@arcor.de>

	* libbalsa/gmime-gpgme-context.c: plug leaks.

2004-08-12  Pawel Salek

	* libbalsa/imap-server.c: do not set key for unitialized object.
	* src/balsa-index.c (balsa_index_selected_list): ref current
	message as all others.

2004-08-12 20:22  PeterB

	* libbalsa/: mailbox.c, message.c: plug leaks.
	* libbalsa/: mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c: cache
	mtimes on first check instead of making careful check.
	* libbalsa/folder-scanners.c, libbalsa/folder-scanners.h,
	src/mailbox-node.c: pass mailbox type to mailbox-handler to avoid
	duplicate call to libbalsa_mailbox_type_from_path.
	* libbalsa/message.c: ignore error return caused by malformed
	header.

2004-08-11  Pawel Salek

	* libbalsa/address-book.c: modify_address not only updates backend
	data but also changes the address itself.
	* libbalsa/address.[hc]: add set_copy() method.
	* src/ab-main.c: make it work (probably has full functionality for
	ldap).

2004-08-10 09:00  PeterB

	* src/: balsa-mblist.c, mailbox-node.c, mailbox-node.h,
	save-restore.c: drop BalsaMailboxNode::expanded; use
	libbalsa_mailbox_get_exposed to decide whether to expand rows.
	* libbalsa/information.c: use one idle handler instead of four;
	check for NULL format string.

2004-08-08  Pawel Salek

	* libbalsa/imap-server.c: failed keep-alives are uninteresting.
	* libbalsa/imap/imap-commands.c: re-select message correctly.
	* src/Makefile.am: mark built sources correctly.
	* src/main.c: fix periodic expunge code.
	* src/sendmsg-window.c: remove '\n' added by ctime_r().

2004-08-08  Carlos Morgado  <chbm gnome.org>

	* src/main-window.c (show_about_box): update my email
	* libbalsa/rfc3156.c: unduplicate message

2004-08-08  Pawel Salek

	* NEWS, configure.in: release 2.2.2.
	* src/save-restore.c: switch SMTP TLS on if available.
	* src/main-window.c: menu item numbering fixes.
	* libbalsa/mailbox.h: mailbox is open even when eg. TREECLEANING.
	* sounds/newmail.wav: less disturbing newmail sound.
	* src/sendmsg-window.c: in-reply-to date must be in C locale.

2004-08-07  21:30 Pawel Salek

	* libbalsa/message.c: canonize headers.
	* src/main-window.c: touchscreen fixes.

2004-08-07  Albrecht Dreß

	* libbalsa/address.h: remove duplicate function prototype.
	* libbalsa/body.[hc]: add a "was_encrypted" flag to the body structure.
	* libbalsa/rfc3156.c: remember if a rfc 3156 body has been
	encrypted, recognise combined signed, fix bad return value.
	* src/balsa-message.c: MDN fixes to make it fully (hopefully) rfc
	3798 compliant.
	* src/information-dialog.c: sanitize messages.

2004-08-07  Pawel Salek

	* libbalsa/imap-server.c: only IMAP_CONNECT_FAILED is a network error.
	* libbalsa/libbalsa.c: display more info about certificates.
	* libbalsa/mailbox.h: use ::state to determine whether mailbox is open.
	* src/balsa-mblist.c: update only msg count for open mailboxes.
	* src/balsa-message.c: set libesmtp auth context only if smtp_user
	present.
	* src/sendmsg-window.c: ditto.
	* src/main-window.c: change button sensitivity in SoS search.

2004-08-06  Pawel Salek

	* libbalsa/imap-server.c: 
	* libbalsa/mailbox_imap.[hc]: simplify slightly cache maintainance.
	* libbalsa/send.c: cancel authentication if no user.
	* src/main.c: do _very_rarely_ expunge after all :-/.
	* src/sendmsg-window.[hc]: cleanup + touchscreen menus.

2004-08-05  Pawel Salek

	* libbalsa/mailbox_imap.c: re-try patches affected filter-on-reception.
	* src/balsa-app.h: add do_file_format_check and enable_view_filter.
	* src/save-restore.c: save and restore them.
	* src/balsa-mblist.c: make sure idle updater does not overwrite
	total message count.
	* src/main-window.c: more touchpad changes. Add a button to SoS filter.
	Remove SoS filter from the Tab-chain.
	* src/sendmsg-window.c: warn windows-oriented users.

2004-08-05 17:05  PeterB

	* src/mailbox-conf.c: redraw fewer display elements and rescan less
	of the tree; keep mailbox open in the backend if possible.
	* libbalsa/: folder-scanners.c, folder-scanners.h: add GType
	parent_type to libbalsa_scanner_local_dir api, and use it to start
	the scanning using the appropriate helper.
	* src/mailbox-node.c: use new api for libbalsa_scanner_local_dir;
	add "append-subtree" support to MH and Maildir mailboxes.

2004-08-05 10:01  PeterB

	* libbalsa/: mailbox_local.c, mailbox_maildir.c, mailbox_maildir.h:
	populate subdir strings when creating a maildir.
	* libbalsa/mailbox.c: set validated state of iter on return.
	* libbalsa/mailbox_imap.c: Revert the
	libbalsa_mailbox_imap_message_match() chunk from the re-try patch.

2004-08-04  Pawel Salek

	* libbalsa/mailbox_imap.[hc]: retry on disconnects.
	* libbalsa/server.c: inform explicitely about used auth method.
	* libbalsa/imap/imap-commands.c: make sure ImapMessage has always
	right UID and Flags.
	* src/balsa-index.c: inform the user if the move/copy was successful.
	* libbalsa/mailbox.h: add LB_MAILBOX_SORT_THREAD.
	* src/main-window.c: cleanup touchpad optimized UI.

2004-08-03 11:47  PeterB

	* libbalsa/Makefile.am, libbalsa/libbalsa.c, libbalsa/libbalsa.h,
	libbalsa/mailbox_imap.c, libbalsa/mailbox_local.c,
	libbalsa/mailbox_maildir.c, libbalsa/mailbox_mbox.c,
	libbalsa/mailbox_mh.c, libbalsa/notify.c, libbalsa/notify.h,
	src/mailbox-node.c: remove libbalsa/notify.[ch].

2004-08-02  Pawel Salek

	* configure.in: get the GSS bit right hopefully this time.
	* libbalsa/identity.c: comment on dialog modality.
	* src/address-book-config.c, src/folder-conf.c: ditto.
	* src/pref-manager.c: same.
	* libbalsa/mailbox.c: load_messages() survives without view.
	* libinit_balsa/balsa-druid-page-directory.c: alternative mailbox names.
	* src/save-restore.c: ditto.
	* src/balsa-app.c: open_inbox_upon startup was never initialized.
	* src/balsa-message.c: add message part button shortcuts.
	* src/sendmsg-window.c: show message before destroying the window.

2004-08-02 15:16  PeterB

	* libbalsa/message.c: ignore content-disposition of first part.
	* libbalsa/mailbox_imap.c: use LIST command and \Marked flag in
	LIST response to test for new mail in a closed mailbox--not
	guaranteed to work, as some servers seem never to use \Marked.

2004-08-02 12:18  Darko Obradovic

	* libbalsa/message.c, libbalsa/message.h, src/balsa-app.h,
	src/message-window.c, src/save-restore.c: make message title
	localizable, not configurable.
	* src/pref-manager.c: ditto; realign codeset option-menu.

2004-08-02 01:27  PeterB

	* src/: balsa-mblist.c, mailbox-node.c, mailbox-node.h: use
	g_signal_has_handler_pending to detect when we need to connect to
	the mailbox's "changed" signal, instead of GObject data.

2004-08-01 00:31  PeterB

	* libbalsa/mailbox_mh.c: check file descriptors for error.

2004-07-31  Pawel Salek

	* configure.in: minor cleanup.
	* src/main-window.c: reset SoS filter on "Mailbox/Reset Filter".
	* src/sendmsg-window.c: inform the user the message has been saved.

2004-07-31 15:19  PeterB

	* src/: balsa-app.h, balsa-index.c, filter-run-dialog.c,
	main-window.c, main.c, pref-manager.c, save-restore.c,
	sendmsg-window.c: new close-mailbox api; remove auto-commit and
	commit-all, and replace commit with expunge; implement
	expunge_on_close; restore hide-deleted to pref-manager, and use to
	initialize mailbox-view's gui-filter.
	* libbalsa/send.c: new close-mailbox api.
	* libbalsa/: mailbox.c, mailbox.h, mailbox_imap.c, mailbox_local.c,
	mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c, mailbox_pop3.c:
	add expunge argument to mailbox-close api, and implement it.
	* doc/C/balsa.xml: replace `commit' with `expunge', and some other
	updates.

2004-07-31 15:05  PeterB

	* libbalsa/mailbox.c: remove a scheduled idle callback if
	libbalsa_mailbox_check is called explicitly.
	* libbalsa/send.c: restore checking the outbox--we can't wait for
	the idle callback.

2004-07-31  Pawel Salek

	* libbalsa/imap-server.c: get the TLS mode right from the config.
	* libbalsa/message.c: tune up libbalsa_message_has_attachment().

2004-07-30  Pawel Salek

	* README, NEWS, configure.in: release 2.2.1
	
2004-07-29  Pawel Salek

	* balsa.spec.in: switch ssl on in binaries.
	* doc/C/balsa.xml: document advanced IMAP folder configuration.
	* libbalsa/message.c: trying to set references again is ok.
	* libbalsa/mailbox.c: set default view to flat index.
	* src/folder-conf.c: fix crash on new folder configuration caused
	by persistent cache code.
	
2004-07-29 17:03  PeterB

	* src/folder-conf.c: non-modal folder properties dialog.
	* src/main-window.c: set sensitivity of next/previous/next-unread
	message menu items.
	* src/main-window.c: remove weak pointer when clearing
	window->current_message.
	* src/balsa-index.c: blank the display when next/previous fails
	only in select-next-threaded, that is, only after deleting the last
	message.
	* src/balsa-message.c: fetch all headers, all the time.
	* libbalsa/: message.c, send.c: remove calls to
	libbalsa_mailbox_check--now handled by mailbox.c
	* libbalsa/mailbox.c: signal mailbox changed only when
	unread-messages flag changes; check mailbox in an idle callback
	after copying in a message; signal mailbox changed when setting
	LIBBALSA_MESSAGE_FLAG_DELETED.

2004-07-28  21:20 Pawel Salek

	* libbalsa/imap-server.[hc]: add "persistent_cache" flag.
	* libbalsa/mailbox_imap.[hc]: support persistent and non-persistent
	caching modes.
	* libbalsa/send.c: strip CRLF from libesmtp messages.
	* src/{folder,mailbox}-conf.c: configure persistent cache.
	* src/sendmsg-window.c: fix GPG build broken by my last commit.
	
2004-07-28 15:09  PeterB

	* libbalsa/mailbox_imap.c: plug leak.
	* src/balsa-index.c: reselect current message only when we need to.
	* src/main-window.c: new mail notification with --disable-threads.

2004-07-28  Pawel Salek

	* libbalsa/identity.[hc]: add a callback routine to notify when
	the identity list is actually changed.
	* libbalsa/imap-server.[hc]: save and restore configurable
	connection limit.
	* libbalsa/message.c: try harder to determine whether the message
	has attachments or not.
	* libbalsa/send.c: check libbalsa_mailbox_copy_message() result.
	* src/balsa-index.[hc]: implement SubjectOrSender filter.
	* src/balsa-message.c: attachment button accepts keyboard input.
	* src/folder-conf.c: configure IMAP connection limit (115023).
	* src/mailbox-conf.[hc]: implement balsa_server_conf_add_spinner().
	* src/mailbox-node.c: use libbalsa_imap_server_save_config().
	* src/main-window.[hc]: add "identities-changed" signal. Create SoS
	filter entry.
	* src/save-restore.c: emit this signal.
	* src/sendmsg-window.c: listen to it. use GtkBox instead of
	GtkPaned. Provide more info on sending failures.
	* src/toolbar-factory.c: change "Cancel" to "Close" compose
	window.

2004-07-27 20:04  PeterB

	* src/: main-window.c, main-window.h: add `notify' to api for
	check_new_messages_count.
	* src/balsa-mblist.c: reselect current mailbox if it becomes
	exposed; don't leave first mailbox highlighted on startup; check
	for finalized mailbox; use `notify' argument to tell
	check_new_messages_count not to popup the new mail message during
	opening and rethreading.
	* src/balsa-index.c: check messages for filtering out of the view
	in an idle handler; don't act on selection-changed if
	mailbox->state == LB_MAILBOX_STATE_TREECLEANING; unselect deleted
	message, so it can be filtered out, even if it's the last message.
	* libbalsa/: mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c: check
	for mailbox->state == LB_MAILBOX_STATE_CLOSING instead of using an
	explicit `closing' argument.
	* libbalsa/: mailbox.c, mailbox.h: add LibBalsaMailbox::state and
	manage it.
	* src/balsa-index.c: fix undelete.

2004-07-27  Pawel Salek

	* libbalsa/imap-server.c: add MAX_CONNECTIONS_PER_SERVER
	constant. Cleanup.
	* libbalsa/libbalsa.h: add TOOMANYOPEN_ERROR code.
	* libbalsa/mailbox.c: do not leak mindex.
	* libbalsa/mailbox_pop3.[hc]: limit POP message size.
	* libbalsa/imap/imap-handle.c: handle NIL message bodies.
	* libbalsa/imap/pop3.c: use LIST instead of STAT.
	* libbalsa/imap/pop3.h: add pop_get_msg_size().
	* src/balsa-app.h: add msg_size_limit parameter.
	* src/balsa-index.[hc]: handle TOOMANYOPEN_ERROR nicely
	(115023). move ::last_use to BalsaMailboxNode.	
	* src/balsa-mblist.[hc]: set BalsaMailboxNode::last_use instead of
	BalsaIndex. Implement balsa_mblist_close_lru_peer_mbx().
	* src/mailbox-node.h: add ::last_use
	* src/main-window.c: rename variable time to delta_time. Set POP
	message size limit.
	* src/pref-manager.c: configure POP message size limit.
	* src/save-restore.c: save and restore it.

2004-07-26 12:15  PeterB

	* src/balsa-message.c: be careful with idle handler.

2004-07-25  Pawel Salek

	* libbalsa/mailbox.[hc], mailbox_imap.c: remove SORT_NATURAL and
	SORT_FROM: duplicated SORT_NO and SORT_SENDER, respectively.
	* src/balsa-index.c: disable column buttons - they confuse tab chain.
	* src/balsa-message.c: limit tab focus to one part only.
	* src/main-window.c: sortin menu entries in touchscreen mode.
	* src/sendmsg-window.c: default toolbar in touchscreen mode.

2004-07-23  Pawel Salek

	* configure.in: add --enable-touch-ui
	* libbalsa/imap-server.c: do not pass OK noise on. 
	* libbalsa/libbalsa.h: separate error class for network problems.
	* libbalsa/send.c: do not use g_strsplit_set() - too new.
	* libbalsa/imap/imap-commands.[hc]: add imap_mbox_close().
	* libbalsa/imap/imap-commands.c: fix error in parsing LIST response.
	* libinit_balsa/balsa-druid-page-directory.c: alternative UI.
	* src/balsa-mblist.c: improve keyboard navigation: only default order.
	* src/mailbox-node.c: report network related problems explicitely.
	* src/main-window.c: streamline UI.
	* src/message-window.c: close with Esc.
	* src/toolbar-factory.c: disable toolbar keyboard navigation.

2004-07-22 07:45  PeterB

	* src/main-window.c: fix bug #148063.

2004-07-21 12:28  PeterB

	* src/main-window.c: switch Message and Mailbox menu positions; add
	accelerators `del' for `toggle deleted' and F9 for `show mailbox
	tree'.
	* src/folder-conf.c: fix problems in creating an imap folder; plug
	memory leak.
	* src/: balsa-message.c, sendmsg-window.c: do not try to change
	flags in a readonly mailbox.
	* src/balsa-mblist.c: plug widget leak.

2004-07-21  Pawel Salek

	* autogen.sh: require automake 1.7
	* src/balsa-message.c: make automatic tests more silent.

2004-07-20 09:34  PeterB

	* src/mailbox-conf.c: don't duplicate a local mailbox in the
	mailbox list when changing properties.

2004-07-19 23:41  PeterB

	* libbalsa/imap/imap-search.c: plug leak.

2004-07-19  Pawel Salek

	* libbalsa/body.[hc]: rename libbalsa_message_body_get_content_type()
	to libbalsa_message_body_get_mime_type() to match the implementation.
	* src, libbalsa: associated changes.
	* libbalsa/mailbox_imap.c: handle imap servers without server-side
	threading.
	* src/information-dialog.c: loose no info messages.
	* src/main.c: shutdown nicely imap connections.
	* libbalsa/imap/imap-commands.c: carefully avoid refetching headers.
	* libbalsa/imap/imap-handle.h:
	* libbalsa/imap/libimap.h: move ImapFetchType to libimap.h

2004-07-18  Pawel Salek

	* libbalsa/body.[hc]: rename ::mime_type to ::content_type
	and store complete content-type header value there.
	* libbalsa/{mailbox_imap,rfc3156,send}.c: associated changes.
	* libbalsa/imap-server.c: lift the number of connections per
	server to 40.
	* libbalsa/imap/imap-handle.[ch]:
	implement imap_body_get_content_type()
	* src/balsa-message.c: again, mime_type->content_type. 
	Failed sig verification messages are made just infos.
	* src/save-restore.c: show information messages in the status bar.
	* src/sendmsg-window.c: mime_type->content_type.

2004-07-16 23:03  PeterB

	* src/balsa-message.c: plug leaks.
* src/: mailbox-node.c, mailbox-node.h: check more carefully for
	pre-existing imap folder; use BALSA_MAILBOX_NODE_NEW_MAILBOX
	GObject data to mark an mbnode with a newly attached mailbox.
	* src/balsa-mblist.c: connect to the mailbox's "changed" signal in
	bmbl_store_redraw_mbnode instead of in
	balsa_mblist_mailbox_node_append; use
	BALSA_MAILBOX_NODE_NEW_MAILBOX GObject data on mbnode to decide
	when we need to connect.
	* libbalsa/mailbox_local.c: free threading info on closing.

2004-07-15  Pawel Salek

	* balsa.spec.in: fix dependencies.
	* libbalsa/imap/imap-commands.c: property type casts.
	* src/balsa-message.c: ditto. All of it pointed by John Dennis.

2004-07-14 23:43  PeterB

	* src/main-window.c: store view filter mask before setting the view
	filter.
	* src/balsa-index.c: block selection "changed" signal handler while
	we change the list of selected messages.
	* src/save-restore.c: save all mailbox-views in the hash table, not
	just those in the mailbox tree.
	* src/balsa-app.c: mark a mailbox-view as not open if we fail to
	open it.

2004-07-13  Carlos Morgado  <chbm gnome.org>

	* libbalsa/imap/imap_private.h: include config.h, 
	aparently ImapMboxHandle wasn't being correctly defined with 
	USE_TLS on some files

2004-07-10  Pawel Salek

	* configure.in, NEWS: release 2.2.0

2004-07-09  Pawel Salek

	* libinit_balsa/balsa-druid-page-finish.c: assure there is a 
	default address book available.
	* src/save-restore.c: clean up the old lists before loading (145701).
	* configure.in: bump the version number to test the release.
	check for gssapi.h header.
	* libbalsa/imap/auth-gssapi.c: depend on HAVE_GSSAPI.
	* src/Makefile.am: fix most of distcheck target.

2004-07-09  Carlos Morgado  <chbm gnome.org>

	* src/mailbox-node.c: 
	back off the rest of Peter's patch (pawel 20040705) 

2004-07-08  Pawel Salek

	* libbalsa/mailbox_pop3.c: patch from 143263.
	* libbalsa/server.c: do not forget the method parameter.
	* libbalsa/imap/Makefile.am: add auth-gssapi.c
	* libbalsa/imap/imap-auth.[hc]: add gssapi to the authenticator list.
	* libbalsa/imap/imap-handle.[hc]: recognize SASL-IR extension.
	* libbalsa/imap/libimap.h: add missing include.
	* libbalsa/imap/util.c (lit_conv_to_base64): fix char indexing.
	* libbalsa/imap/auth-gssapi.c: GSSAPI authentication.
	* libbalsa/filter.c: fix searching CC in local mailboxes.

2004-07-07 23:16  PeterB

	* src/print.c: compile with HAVE_GPGME && !HAVE_GTKHTML.

2004-07-08  Albrecht Dreß

	* configure.in: require gmime-2.1.7.
	* libbalsa/rfc3156.c:
	* libbalsa/gmime-part-rfc2440.[hc]: 
	* libbalsa/gmime-gpgme-{context,signature}.[ch]: GPGME fixes. See eg.
	 http://mail.gnome.org/archives/balsa-list/2004-May/msg00067.html

2004-07-07  Pawel Salek

	* libbalsa/send.c: fix sendmail build (143322).
	* libbalsa/address-book-{vcard,ldif}.c: correct error checking.

2004-07-06  Pawel Salek

	* NEWS, configure.in: release 2.1.91.

2004-07-06  Pawel Salek

	* libbalsa/address-book-{vcard,ldif}.c: add addresses to empty
	address books.
	* libbalsa/mailbox_mbox.c: set recent flags on added messages.
	* libbalsa/message.c: no references are ok.
	* src/Makefile.am: Fix bonobo building.
	* libbalsa/Makefile.am: remove notify.c.
	* libbalsa/*.c: compile with C89.
	* src/*.c: 
	* libinit_balsa/balsa-druid-page-directory.c: ditto.
	* src/main-window.c: disable calls to noop notify functions.

	* libbalsa/mailbox_imap.c: safety net.
	* libbalsa/imap/imap-commands.[hc]: compilation fixes.
	* src/main-window.c: do not crash on clicking "clear" in Find dialog.

2004-07-05  Pawel Salek

	* src/balsa-mblist.c: collapse multiple ::update_mailbox events.
	* src/balsa-message.c: set proper date on MDN (Albrecht Dreß).
	* src/mailbox-node.c: make sure "changed" is set for scanned mailboxes.
	* libbalsa/{misc,address-book-vcard}.c: 64bit-fixes from FC2.
	* libinit_balsa/balsa-druid-page-directory.c: spoolbox from FC2.

2004-07-04  Carlos Morgado  <chbm gnome.org>

	* libbalsa/imap/imap-handle.c (imap_mbox_connect): 
	plug slight memory leak in handle->sio

2004-07-03  Pawel Salek

	* configure.in, NEWS: release 2.1.90
	* libbalsa/imap/imap-handle.c: fix without-ssl build.

2004-07-03  Carlos Morgado  <chbm gnome.org>

	* src/mailbox-node.c: patch from PeterB to fix 
	the multiple INBOXmbnodes problem 

2004-07-03  Albrecht Dreß

	* src/balsa-message.[hc]: The patch as in
	http://mail.gnome.org/archives/balsa-list/2004-July/msg00002.html

2004-06-27  Carlos Morgado  <chbm gnome.org>

	* libbalsa/imap/imap-handle.c (imap_mbox_connect): 
	clear tls status on forcefull disconnect
	(it leaked passwords over non tls gah!)

2004-06-19  Pawel Salek

	* libbalsa/libbalsa.c: disable debugging output.
	* libbalsa/imap/*.c: check the connection states more carefully.
	
2004-06-16 07:41  PeterB

	* libbalsa/mailbox.c: flush the display instead of syncing it, to
	improve performance especially on a remote display.

2004-06-15 10:59  PeterB

	* src/balsa-app.c, src/balsa-app.h, src/balsa-index.c,
	libbalsa/mailbox.c, libbalsa/mailbox.h, libbalsa/misc.c,
	libbalsa/misc.h, src/balsa-mblist.c, src/mailbox-conf.c,
	src/mailbox-node.c, src/main-window.c, src/main.c,
	src/pref-manager.c, src/save-restore.c, src/sendmsg-window.c:
	implement accessors for LibBalsaMailboxView; use
	libbalsa_mailbox_view_default for default values; don't put default
	values in the config file; implement libbalsa_urldecode to get url
	from config key; remove balsa_app.threading_type and
	balsa_app.mailbox_views.

2004-06-15 09:51  PeterB

	* libbalsa/: mailbox.c, mailbox_imap.c: check for NULL message and
	message-entry.

2004-06-13 09:29  PeterB

	* src/: balsa-index.c, balsa-index.h, main-window.c: implement and
	use balsa_index_expunge, to block the selection-changed handler
	while expunging.

2004-06-13  Carlos Morgado  <chbm gnome.org>

	* libbalsa/message.c: make build with DEBUG

2004-06-10  Pawel Salek

	* src/balsa-message.c: proper msg popup menus (Albrecht Dreß).
	* src/folder-conf.c: use gtk_dialog_run as required by spec.

2004-06-08  Pawel Salek

	* libbalsa/mailbox-filter.c: compile.
	* libbalsa/imap/imap-commands.c: set the readonly argument
	also when the handle has been already selected.
	* libbalsa/mailbox_{maildir,mbox,mh}.c: set readonly flag
	in a more robust way.

2004-06-07 16:51  PeterB

	* libbalsa/: mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c:
	manage `recent' flag.
	* libbalsa/: message.c, message.h: drop
	libbalsa_message_clear_recent--it's the driver's responsibility.
	* libbalsa/mailbox.c, src/balsa-index.c: check message number when
	searching.
	* libbalsa/mailbox-filter.c: match URL exactly when looking up
	filter section.
	* libbalsa/mailbox_local.c: retrieve user headers more reliably.

2004-06-06 20:11  PeterB

	* libbalsa/source-viewer.c, src/sendmsg-window.c:
	GTK_WRAP_WORD_CHAR is since gtk-2.4.0.
	* libbalsa/mailbox_mbox.c: change preface or postface only when
	non-NULL.
	* libbalsa/mailbox_mbox.c: space-stuff From_ lines in multipart
	preface and postface.

2004-06-04 17:47  PeterB

	* libbalsa/mailbox.c, libbalsa/mailbox.h, libbalsa/mailbox_imap.c,
	libbalsa/mailbox_local.c, libbalsa/mailbox_maildir.c,
	libbalsa/mailbox_mbox.c, libbalsa/mailbox_mh.c, libbalsa/message.c,
	libbalsa/message.h, src/balsa-message.c: drop
	message->{status,attach}_icon.
	* src/filter-edit-callbacks.c: don't crash on new filter.
	* src/filter-edit-callbacks.c: allow editing of compound
	conditions.
	* libbalsa/filter-funcs.c: eat space between left and right
	conditions.
	* src/main-window.c: document, and fix typo.
	* src/: balsa-app.c, balsa-index.c, filter-run-callbacks.c,
	main-window.c, main-window.h, pref-manager.c: don't refer to
	balsa_app.main_window in src/main-window.c.

2004-06-02 12:51  PeterB

	* src/toolbar-factory.c: simplify balsa_toolbar_remove_all; make
	bti->widget a weak pointer.

2004-05-31  Pawel Salek

	* libbalsa/libbalsa.[ch]: simplify thread recognition, do not
	destroy static mutexes.
	* libbalsa/{mailbox_local,rfc3156.c}.c: use
	libbalsa_am_i_subthread().
	* libbalsa/imap/imap-commands.c: actually do rename.
	* src/balsa-app.c: do not destroy static mutexes. Use
	libbalsa_am_i_subthread(). Fix multiple IMAP server tree scanning.
	* src/balsa-mblist.c: use fixed balsa_find_dir().
	* src/mailbox-node.c: ditto.
	* src/main-window.c: check for main window existence before
	refreshing.
	
2004-05-28 14:21  PeterB

	* libbalsa/source-viewer.c, src/sendmsg-window.c: allow GtkTextView
	to break words when it's in a widget that doesn't allow horizontal
	scrolling.
	* src/main-window.c: tweak border width.
	* src/: balsa-index.c, balsa-index.h: rest of the previous commit!
	* doc/C/balsa.xml, src/main-window.c: redesign Edit->Find dialog,
	and add help.

2004-05-27 07:11  PeterB

	* libbalsa/: mailbox_pop3.c, mailbox_pop3.h: dump
	pop->last_popped_uid.

2004-05-26 14:06  PeterB

	* doc/C/balsa.xml, libbalsa/folder-scanners.c,
	libbalsa/folder-scanners.h, src/balsa-app.c, src/balsa-app.h,
	src/mailbox-node.c, src/pref-manager.c, src/save-restore.c:
	deferred folder scanning for local folder trees.

2004-05-26 11:04  PeterB

	* src/balsa-index.c: build with gtk+-2.0 < 2.2.0.
	* src/balsa-index.c: Manu: one more recursion killed, in
	bndx_expand_to_row; deselect hidden messages when a new message
	is selected.

2004-05-25 18:51  PeterB

	* src/: balsa-app.c, balsa-index.c, mailbox-node.c, main-window.c:
	bullet-proof against closing during startup.
	* libbalsa/mailbox.c: Manu: make get-path-helper nonrecursive.
	* libbalsa/mailbox.c: run filters on recent undeleted messages, not
	all recent.
	* src/: main-window.c, main-window.h: pass BalsaWindow as an
	argument to balsa_window_enable_mailbox_menus, instead of using
	balsa_app.main_window.
	* src/balsa-index.c: supply new argument to
	balsa_window_enable_mailbox_menus; check BALSA_IS_INDEX(index) in
	exported select methods.

2004-05-24 18:59  PeterB

	* src/: mailbox-conf.c, main-window.c, main-window.h: update the
	display when a special mailbox name is changed.

2004-05-24 17:34  PeterB

	* libbalsa/folder-scanners.c, libbalsa/folder-scanners.h,
	libbalsa/mailbox_local.c, src/balsa-app.c, src/balsa-app.h,
	src/balsa-index.c, src/balsa-mblist.c, src/balsa-mblist.h,
	src/filter-edit-callbacks.c, src/folder-conf.c, src/mailbox-conf.c,
	src/mailbox-node.c, src/mailbox-node.h, src/main-window.c,
	src/main-window.h, src/main.c, src/pref-manager.c,
	src/save-restore.c, src/save-restore.h: remove
	BalsaApplication::mailbox_nodes;
	BalsaApplication::mblist_tree_store owns its BalsaMailboxNodes.

2004-05-24 09:05  PeterB

	* libbalsa/mailbox.[ch], libbalsa/message.c, src/balsa-message.c:
	update the cached icon as well as the message icon; shift the
	responsibility for signalling "row-changed" to the mailbox code.

2004-05-22  Pawel Salek

	* balsa.spec.in: Balsa.idl should be distributed.
	* configure.in, NEWS: release 2.1.3.
	* src/Makefile.am: proper location of Balsa.idl

2004-05-22  Pawel Salek

	* libbalsa/imap-server.c. libinit_balsa/balsa-druid-page-directory.c:
	compile without SSL.
	* Makefile.am, balsa.desktop.in: 
	* po/POTFILES.in: i18n patch from report 142769.
	* src/Makefile.am: bug 142958.
	* libbalsa/gmime-gpgme-{context,signature}.c: compile without GPGME.
	* libbalsa/gmime-part-rfc2440.c: ditto.
	* src/mailbox-conf.c: fix configuration of IMAP mailboxes.
	
2004-05-15 16:12  PeterB

	* src/message-window.c: keep MessageWindow::bmessage alive while we
	change MessageWindow::message.

2004-05-11 15:02  PeterB

	* src/main-window.c: make commit item insensitive for readonly
	mailbox.
	* src/main-window.c: don't sync read-only mailbox.

2004-05-09  Albrecht Dreß

	* libbalsa/body.[hc]: cleanup.
	* libbalsa/mailbox.c: same here.
	* libbalsa/message.c: same here.
	* src/balsa-message.c: fetch signed part earlier.

2004-05-09  Pawel Salek

	* libbalsa/mailbox_imap.c, libbalsa/imap/pop3.c
	* src/information-dialog.c, src/main-window.c: format fixes.
	* src/message-window.c: unregister weak references in proper order.

2004-05-08  Pawel Salek

	* libbalsa/imap-server.c: allow disabling TLS.
	* libbalsa/{mailbox_pop3,server}.c: ditto.
	* libbalsa/server.h: declare related constants.
	* libbalsa/imap/imap-handle.[ch]: backend support for that.
	* libbalsa/imap/{imap_private,libimap}.h: ditto.
	* libbalsa/imap/pop3.[hc]: same for POP.
	* src/{folder,mailbox}-conf.c: UI for this functionality.
	* src/mailbox-node.c: ditto.
	* src/save-restore.c: clean mailbox-node section before saving.

2004-05-08 08:23  PeterB

	* libbalsa/mailbox.c: don't cache has-unseen-child.

2004-05-07 07:06  PeterB

	* libbalsa/mailbox.c: ditto

2004-05-07  Pawel Salek

	* libbalsa/mailbox.c: do not assume you have all the entries.

2004-05-07 00:44  PeterB

	* libbalsa/: mailbox_maildir.c, mailbox_mh.c: load flags correctly.
	* libbalsa/mailbox.c: check for NULL entry.
	* libbalsa/mailbox.c: manage has-unseen-child flag.

2004-05-06 17:25  PeterB

	* src/message-window.c: keep the message reffed, to hold the window
	open until the mailbox is closed.
	* libbalsa/source-viewer.c: ref the message instead of weak-ref.
	* src/balsa-index.c: clean up selected list when closing.
	* libbalsa/mailbox_mbox.c: use weak-ref, not weak-pointer--Pawel
	had it right!

2004-05-05 15:40  PeterB

	* libbalsa/: mailbox_maildir.c, mailbox_mbox.c: set msg->flags from
	msg_info->flags.
	* src/message-window.c: plug ref leak.
	* src/balsa-index.c: prune dead code.
	* src/mailbox-node.c: restore new mail check in closed mailboxes.
	* libbalsa/: mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c:
	restore new mail check in closed mailboxes; manage message
	references.
	* libbalsa/: mailbox_local.c, mailbox_local.h, message.c: simplify
	mailbox locking; restore threading in local mailboxes.
	* libbalsa/: mailbox.c, mailbox.h: simplify mailbox locking; drop
	LibBalsaMailboxIndexEntry::msgno; add accessors for
	LibBalsaMailboxIndexEntry members.
	* libbalsa/: filter.c, filter.h, libbalsa_private.h,
	mailbox_imap.c: simplify mailbox locking.

2004-05-05  Pawel Salek

	* libbalsa/mailbox.[ch]: be more compatible with --disable-threads.
	* libbalsa/mailbox_mbox.c: fix old and new bugs.
	* src/balsa-mblist.c: gtk can pass empty list of selected messages
	for d&d.

2004-05-04  Pawel Salek

	* libbalsa/folder-scanners.c: report IMAP server messages.
	* libbalsa/imap-server.[hc],libbalsa.h: ditto.
	* libbalsa/mailbox.[ch]: more detailed error messages.
	* libbalsa/mailbox_{imap,maildir,mbox,mh,pop3}.c: ditto.
	* libbalsa/send.c: adjust to changed API.
	* libbalsa/imap/{auth-cram,imap-auth}.c:
	* libbalsa/imap/imap{-handle.c,_private.h}:
	store last server msg.
	* libbalsa/imap/pop3.c: respect DISABLE_APOP flag.
	* src/balsa-index.[hc]: adjust to changed API.
	* src/filter-run-dialog.c:
	* src/{main,sendmsg}-window.c: ditto.
	* src/mailbox-conf.c: reenable APOP disabling.

2004-05-03  Pawel Salek

	* configure.in: use GTK_CHECK_VERSION instead of HAVE_GTK24.
	* libbalsa/filter-funcs.c: use reentrant localtime_r().
	* libbalsa/rfc3156.c: ditto.
	* src/filter-edit-callbacks.c: ditto.
	* libbalsa/libbalsa.[ch]: move libbalsa_date_to_gchar() and
	libbalsa_get_icon_from_flags() here.
	* libbalsa/mailbox.[hc]: implement LibBalsaMailboxEntry to reduce
	memory usage.
	* libbalsa/mailbox_{imap,local,maildir,mbox,mh,pop3}.c: use it.
	* libbalsa/message.[ch]: add code to aid Message reference debugging.
	* libbalsa/send.c: ref and unref correctly.
	* src/{balsa-index,main-window,sendmsg-window}.c: ditto.

2004-04-29  Pawel Salek

	* configure.in: INTLTOOL needed for FC2.
	* src/sendmsg-window.c: postpone messages very carefully.
	* bootstrap.sh: cheap autogen.sh replacement.

2004-04-27 11:07  PeterB

	* libbalsa/rfc3156.c: build --with-gpgme --disable-threads.

2004-04-26 20:00  PeterB

	* libbalsa/filter-file.c, libbalsa/filter-funcs.c,
	libbalsa/filter.h, libbalsa/mailbox.c, src/filter-edit-callbacks.c,
	src/save-restore.c: ease migration of filters from 2.0-style config
	to 2.1-style.

2004-04-25 11:35  PeterB

	* libbalsa/send.c: check for error return from
	libbalsa_mailbox_open.

2004-04-24  Carlos Morgado  <chbm gnome.org>

	* libbalsa/Makefile.am: back out reintroduction of _DEPRECATED, 
	we're not trying to be 2.6 clean yet

2004-04-24  Pawel Salek

	* libbalsa/message.c: do not release too many headers on body_unref().

2004-04-23 08:14  PeterB

	* src/balsa-mblist.c: split message (bug #116604).

2004-04-22  Pawel Salek

	* libbalsa/libbalsa.c: no-SSL build fixes.
	* libbalsa/send.c: libesmtp-1.0.3 release delayed.

2004-04-21 12:42  PeterB

	* libbalsa/mailbox_imap.c: map IMBENC_OTHER to
	GMIME_PART_ENCODING_DEFAULT.
	* src/: balsa-mblist.c, main-window.c: use ngettext--fix for bug
	#116604.
	* libbalsa/message.c: libbalsa_message_set_headers_from_string sets
	all headers again.

2004-04-20  Pawel Salek

	* libbalsa/libbalsa.[hc]: unify SMTP/IMAP/POP certificate management.
	* libbalsa/send.c: support better SMTP TLS (requires libesmtp-1.0.3).
	* libbalsa/server.[hc]: simplify.
	* src/main-window.c: respect "Cancel" button.
	* libbalsa/gmime-gpgme-context.c: pass name (Albrecht Dress).

2004-04-20 15:44  PeterB

	* libbalsa/message.c: don't add to user_hdrs when processing basic
	headers.
	* src/message-window.c: set title bar when message is set.
	* src/balsa-message.c: check GMIME_IS_PART(info->body->mime_part).
	* libbalsa/gmime-part-rfc2440.c: check for empty content.
	* libbalsa/filter.c, libbalsa/mailbox.c, libbalsa/mailbox.h,
	libbalsa/mailbox_local.c, src/balsa-index.c, src/main-window.c:
	check messages against view-filter after filtering; allow NULL
	condition and search-iter.

2004-04-20 00:30  PeterB

	* libbalsa/message.c: clear message->has_all_headers when extra
	headers are destroyed.
	* libbalsa/message.c: don't add standard headers to user_hdrs.

2004-04-19  Pawel Salek

	* libbalsa/filter.c: update argument list of message_body_ref().
	* libbalsa/send.c: ditto.
	* libbalsa/mailbox_imap.c: correctly fetch-headers on fetch-struct.
	* libbalsa/mailbox_local.c: ditto.
	* libbalsa/mailbox_mbox.c: set message length.
	* libbalsa/message.[ch]: fetch msg structure and headers in one shot.
	* src/balsa-message.c: update argument list of message_body_ref().
	* src/{sendmsg-window,print}.c: ditto.
	* libbalsa/mailbox.c: make sure not to break group-reply.

2004-04-19 09:17  PeterB

	* src/balsa-message.c: emit "row-changed" signal after updating the
	attach icon.

2004-04-18  Albrecht Dress

	large GPG patch as in 124905, attachment 26752.
	
2004-04-16  Adam Weinberger  <adamw@gnome.org>

	* en_CA.po: Added en_CA to ALL_LINGUAS.

2004-04-14  Pawel Salek

	* libbalsa/html.c: change op order to make gtkhtml2 happy.

2004-04-14 05:50  PeterB

	* src/sendmsg-window.c: clear old auto-bcc when changing
	identities, if that's the only bcc entry.
	* src/sendmsg-window.c: be more careful when changing identities.

2004-04-13 21:34  PeterB

	* libbalsa/: imap-server.c, mailbox_imap.c, mailbox_imap.h: lock
	the mailbox in "expunge-notify" handler; remove unnecessary handler
	in imap-server and unused hook in mailbox-imap.

2004-04-12  Pawel Salek

	* libbalsa/misc.c: fix fcntl() locking.
	* src/balsa-icons.[hc]: make "deleted" icon size match other icons.

2004-04-12  Pawel Salek

	* libbalsa/mailbox.[hc]: fetch headers smarter.
	* libbalsa/mailbox_imap.c: provide subclasses for _fetch_headers.
	* libbalsa/mailbox_local.c: ditto.
	* libbalsa/message.[hc]: use it.
	* libbalsa/imap/imap-commands.c: cleanup.
	* src/sendmsg-window.c: make sure we know all the relevant headers.

2004-04-11  Carlos Morgado  <chbm gnome.org>

	* libbalsa/Makefile.am: 
	remove *_DISABLE_DEPRECATED

2004-04-11  Pawel Salek

	* libbalsa/mailbox_imap.c: fetch references and list-post. 
	* libbalsa/message.c: remove unused data. Parse sequences of headers.xo
	* libbalsa/imap/imap-commands.[hc]: simplify fetching code.
	* libbalsa/imap/imap-handle.[hc]: handle HEADER.FIELDS.NOT.

2004-04-07  Pawel Salek

	* libbalsa/mailbox_imap.c: do not quit when talking to non-IMAP servers
	* src/sendmsg-window.c: check message_postpone() return code.

2004-04-07 06:55  PeterB

	* libbalsa/imap/pop3.c: free pop->host.
	* libbalsa/: mailbox_local.c, mailbox_maildir.c, mailbox_mbox.c,
	mailbox_mh.c, message.c, message.h: scrap
	LibBalsaMessage::references_for_threading and create the list on
	the fly instead; allocate extra headers in body-ref and deallocate
	them in body-unref.

2004-04-06  Pawel Salek

	* libbalsa/mailbox.c: make nth_child return correct answer for closed
	mailboxes.
	* libbalsa/message.c: simplify prepend_header_misc().
	* libbalsa/imap/pop3.c: gracefully handle timeouts after initial
	greeting but before authentication.

2003-04-05  Emmanuel Allaud

	* src/mailbox-conf.c: fix crash on IMAP mailbox configuration.

2004-04-05  Pawel Salek

	* NEWS, configure.in: release balsa-2.1.2

2004-04-04  Pawel Salek

	* libbalsa/mailbox_local.c: make sure to kill the delayed sync handler
	before closing the mailbox. Lock properly, too.
	* libbalsa/mailbox_pop3.c: cleanup and improve progress indication.
	* libbalsa/imap/pop3.[ch]: armour the code against broken connections.
	* src/main-window.c: change slightly displaying format.

2004-04-03  Pawel Salek

	* libbalsa/imap/pop3.h: implement pipelined pop3 fetching.
	* libbalsa/mailbox_pop3.c: use it.

2004-04-02 06:45  PeterB

	* libbalsa/mailbox_mbox.c: when rewriting the mbox in a sync, use
	g_mime_stream_write_to_stream instead of
	g_mime_message_write_to_stream.

2004-04-01 11:50  PeterB

	* src/: balsa-index.c, balsa-index.h: desensitize menu items that
	change flags in a readonly mailbox.
	* libbalsa/message.c: warn if we try to change flags in a readonly
	mailbox.
	* libbalsa/mailbox.c: set theading only in an open mailbox; don't
	try to change flags in a readonly mailbox.

2004-04-01  Pawel Salek

	* libbalsa/imap/*.c: compile without SSL and with gmime-2.1.3.

2004-03-31  Carlos Morgado  <chbm gnome.org>

	* src/balsa-message.c: quote argument when we invoke a vfs command

2004-03-31 09:24  PeterB

	* src/main-window.c: handle mailbox-changed signal in an idle
	handler.
	* libbalsa/imap/imap-handle.c: declaration out of order.

2004-03-30 15:39  PeterB

	* libbalsa/: mailbox_local.c, mailbox_maildir.c, mailbox_mbox.c,
	mailbox_mh.c: use libbalsa_mailbox_run_filters_on_reception in
	libbalsa_mailbox_local_load_messages instead of the individual
	drivers.
	* libbalsa/mailbox_imap.c: implement
	LibBalsaMailboxImap::search_stamp; new api for
	libbalsa_mailbox_run_filters_on_reception; remove dead code.
	* libbalsa/: mailbox.c, mailbox.h: scrap
	libbalsa_mailbox_invalidate_iters, and invalidate them only when
	really necessary; clean up
	libbalsa_mailbox_run_filters_on_reception; use separate keys for
	added and promoted.

2004-03-29 21:34  PeterB

	* src/main-window.c: clear BalsaWindow::current_message in destroy
	method--it seems to be called twice.

2004-03-29  Pawel Salek

	* configure.in: do not bother checking for intltool - we do not use it.
	* libbalsa/mailbox_local.[hc]: adaptive syncing delay.
	* libbalsa/mailbox_{mbox,maildir,mh}.c: matching changes.
	* libbalsa/imap/pop3.c: close the descriptor.
	* src/Makefile.am: test compilation on GNOME-2.6
	* src/toolbar-factory.c: toolbar modification on gtk2.4

2004-03-28 14:33  PeterB

	* libbalsa/libbalsa.c: lock the mutex before waiting on the
	condition.

2004-03-28  Pawel Salek

	* libbalsa/mailbox_local.c: remove the idle sync handler on finalize.
	Wait for three idle seconds before running.
	* libbalsa/mailbox_mh.c: do not leak descriptors.
	* libbalsa/mailbox_pop3.c: creat() returns a descriptor that has
	to be closed.

2004-03-27 23:24  PeterB

	* src/: main-window.c, balsa-mblist.c: manage notebook-tab
	label-style in main-window.c instead of balsa-mblist.c.
	* src/mailbox-node.c: don't die on invalid local mailbox type.
	* libbalsa/mailbox.c: check that a file is empty or begins with
	"From " before deciding it's a LibBalsaMailboxMbox; check for NULL
	condition.

2004-03-27  Pawel Salek

	* libbalsa/Makefile.am: remove old POP3 support.
	* libbalsa/server.[hc]:
	* libbalsa/imap-server.c: share SSL code between IMAP and POP.
	* libbalsa/mailbox_imap.[hc]: remove old crust.
	* libbalsa/mailbox_pop3.[hc]: use new POP3 code, fix 104963, 134912.
	* libbalsa/misc.c: remove plenty of space.
	* libbalsa/imap/Makefile.am: add new POP support.

	* libbalsa/imap/{auth-cram,imap-auth}.c: share code between pop
	and IMAP.
	* libbalsa/imap/{imap-auth.h,imap-handle.c,imap_private.h}: ditto.
	* src/ab-window.c: revoke libbalsa_option_menu() patch of 2004-03-07:
	it was a bad idea.
	* src/store-address.c, etc: ditto.
	* libbalsa/imap/pop3.[hc]: implement pop3s for the sake of completness.

2004-03-26 17:05  PeterB

	* libbalsa/mime.c: file descriptor leak.
	* libbalsa/mailbox.c: lock the mailbox while searching it.
	* libbalsa/body.c: use the GError argument of g_file_open_tmp.
	* libbalsa/: mailbox_maildir.c, mailbox_maildir.h: test the subdirs
	for write permission, as well as the main dir--set readonly if any
	fails.

2004-03-25 12:45  PeterB

	* src/balsa-index.c: report errors when copying or moving messages.
	* libbalsa/mailbox_mbox.c: open read-only mailbox correctly.
	* src/filter-run-callbacks.c, libbalsa/filter.c, libbalsa/filter.h,
	libbalsa/mailbox.c, libbalsa/mailbox.h, libbalsa/mailbox_imap.c,
	libbalsa/message.c: use a GArray to pass a list of message numbers;
	implement and use libbalsa_mailbox_register_msgnos, to update
	message numbers in a GArray when a message is expunged.

2004-03-22 21:02  PeterB

	* src/sendmsg-window.c: body_ref the message before getting
	charset; check libbalsa_mailbox_open for errors and re-enable
	message save.
	* src/balsa-index.c: get first_unread on-screen, if possible.
	* libbalsa/mailbox_imap.c: keep first_unread current.
	* configure.in: detect libgtkhtml-3.1.

2004-03-22  Pawel Salek

	* libbalsa/libbalsa.c: release gdk lock when waiting for mailbox
	lock.
	* libbalsa/mailbox{,_imap}.c: update counters in an idle function.
	* src/main-window.c: show message source without preview active.

2004-03-20 08:13  PeterB

	* libbalsa/mailbox_imap.c: (libbalsa_mailbox_imap_messages_copy)
	allow NULL search_iter.
	* libbalsa/: mailbox.c, message.c: use bulk copy and move methods.
	* src/balsa-index.c: use a LibBalsaMailboxSearchIter, to allow
	caching of search results.
	* libbalsa/: mailbox.c, mailbox.h: implement
	libbalsa_mailbox_search_iter_view.

2004-03-19 21:51  PeterB

	* src/: balsa-index.c, balsa-index.h: maintain list of selected
	messages; check a message that leaves the list against the current
	view-filter; keep multiple selections.
	* libbalsa/mailbox_local.c: check the msg_tree when changing
	view-filter.
	* libbalsa/: mailbox.c, mailbox.h: implement
	libbalsa_mailbox_msgno_deselected.
	* libbalsa/: mailbox_maildir.c, mailbox_mh.c: be more careful
	dereferencing message info array.

2004-03-18  Pawel Salek

	* libbalsa/mailbox_imap.c: process flags in batches.
	* libbalsa/imap/imap-commands.c: send batches of flags via imap_cb
	* libbalsa/imap/imap-handle.c: similarly here.
	* libbalsa/imap/imap-handle.h: change imap_cb typedef.

2004-03-16 17:13  PeterB

	* libbalsa/mailbox.c: show unread status of deleted messages.
	* libbalsa/mailbox.c: set the value even if the tree-view is not
	realized.

2004-03-15 15:02  PeterB

	* src/balsa-index.c: don't connect to mailbox's "row-changed"
	signal--"changed" is enough.
	* src/balsa-mblist.c: update total messages when mailbox is closed.
	* libbalsa/: message.c, message.h: check that flags really change.
	* libbalsa/: mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c:
	signal new mailbox size when closing.
	* libbalsa/mailbox_local.c: don't emit signal; set unread-messages
	flag only if new mail arrived.
	* libbalsa/mailbox.c: check that message flags really change.

2004-03-14 09:15  PeterB

	* src/balsa-mblist.c: connect to mailbox's "changed" signal instead
	of "set-unread-messages-flag" and "messages-status-changed".
	* libbalsa/message.c: libbalsa_mailbox_copy_message returns +/-1,
	not TRUE/FALSE.
	* libbalsa/mailbox_imap.c: check for mailbox lock in flags- and
	exists- callbacks; sort msgnos when copying.
	* libbalsa/: mailbox.c, mailbox.h: scrap "messages-status-changed"
	and "set-unread-messages-flag" signals; emit "changed" when we
	might need to inform the front-end; streamline counting unread
	messages.
	* libbalsa/filter-funcs.c: Manu: use macro.

2004-03-13 13:06  PeterB

	* libbalsa/body.c: empty GMimePart is OK.

2004-03-12 22:33  PeterB

	* libbalsa/: mailbox.c, mailbox_imap.c, message.c: in imap mailbox,
	apply filters in EXISTS response handler; clean up flags-handling.
	* libbalsa/: body.c, mailbox_imap.c, mailbox_local.c:
	get_message_part returns NULL if the part is not a GMimePart.
	* libbalsa/mailbox_mbox.c: crlf-filter incoming message, not just
	text parts.

2004-03-12  Pawel Salek

	* src/sendmsg-window.c: disentangle charset/attachment
	initialization order.
	* libbalsa/filter.c: compare filter names correctly (Emmanuel).

2004-03-10 11:39  PeterB

	* configure.in: when $prefix is `NONE', replace with correct
	default `/usr/local'.

2004-03-08  Pawel Salek

	* libbalsa/folder-scanners.[ch]: pass around Marked mailbox flag.
	* libbalsa/mailbox.c: lock mailbox in ::set_threading.
	* src/balsa-index.c: set fixed column sizes.
	* src/balsa-mblist.c: use Marked mailbox flags.
	* src/mailbox-node.c: ditto.

2004-03-07  Pawel Salek

	* configure.in: check for gtk2.3
	* libbalsa/Makefile.am: add option_menu.[hc]
	* libbalsa/files.c: try harder when looking for images.
	* libbalsa/mailbox.c: use fixed_height gtk2.4 mode.
	* libbalsa/imap/imap-{handle,tls}.c: silence.
	* src/Makefile.am: enable deprecated for gtk-2.4
	* src/ab-window.c: use option_menu
	* src/store-address.c: ditto.
	* src/balsa-index.c: setup fixed_height mode.
	* src/mailbox-conf.c: compile against gnome-2.6
	* src/main.c: do not panic on missing icons.
	* src/pref-manager.c: ask gnome-2.6 to enable deprecated stuff.

2004-03-07 12:33  PeterB

	* libbalsa/filter.c, libbalsa/filter.h, libbalsa/libbalsa.h,
	libbalsa/mailbox.c, libbalsa/mailbox.h, libbalsa/mailbox_imap.c,
	libbalsa/mailbox_local.c, libbalsa/message.c, libbalsa/message.h,
	libbalsa/imap/imap-commands.c, libbalsa/imap/imap-search.c,
	src/filter-run-callbacks.c: re-enable filters.

2004-03-06 16:59  PeterB

	* libbalsa/body.c: check for NULL GMime filter.
	* libbalsa/: mailbox.c, message.c: lock source mailbox when copying
	or moving messages.
	* libbalsa/libbalsa_private.h: complete previous commit.
	* libbalsa/: libbalsa_private.h, mailbox_imap.c: define and use
	HAVE_MAILBOX_LOCKED(mailbox) to check locking.
	* libbalsa/body.c, libbalsa/mailbox-filter.c,
	libbalsa/mailbox_imap.c, libbalsa/imap/imap-commands.c,
	src/balsa-index.c, src/balsa-message.c: plug memory leaks.

2004-03-05  Pawel Salek

	* libbalsa/mailbox_imap.c: use single API for one and multiple
	message copying/flagging.

	* libbalsa/imap/imap-commands.[hc]: add function for copying
	multiple messages. merge store_flag and store_flag_m().
	
2004-03-04 15:02  PeterB

	* libbalsa/mailbox_mbox.c: crlf-filter message parts, not the whole
	message.
	* libbalsa/filter-funcs.c: step over closing '"'.
	* configure.in, libbalsa/html.c: require gmime-2.0 >= 2.1.2; drop
	HAVE_GMIME21.

2004-02-03  Pawel Salek

	* libbalsa/imap/imap-auth.c: cleanup.
	* libbalsa/imap/imap-commands.[hc]: use proper UTF-7 encoding.
	* libbalsa/imap/imap-handle.[hc]: ditto. Cleanup.
	* libbalsa/imap/util.[hc]: add routines for UTF-7 encoding.

2004-02-30  Pawel Salek

	* configure.in, NEWS: release 2.1.1
	* libbalsa/mailbox.c: do not die when an unvisible message is
	  modified.
	* src/main-window.c: improve filtering support.

2004-02-29 11:22  PeterB

	* src/balsa-index.c: emit "changed" signal even when no message is
	selected.
	* src/main-window.c: implement persistent search-iters.
	* src/: balsa-index.c, balsa-index.h: implement persistent
	search-iters; rearrange search code.
	* libbalsa/mailbox_local.c: new name for match_condition.
	* libbalsa/mailbox_imap.c: implement persistent search-iters.
	* libbalsa/: mailbox.c, mailbox.h: support persistent search-iters.
	* libbalsa/: filter.c, filter.h: rename match_condition as
	libbalsa_condition_matches; implement libbalsa_condition_can_match.

2004-02-28  Pawel Salek

	* libbalsa/filter-funcs.c: implement libbalsa_condition_new_date()
	* libbalsa/filter.h: add proper prototype.
	* libbalsa/mailbox_imap.c: fix lbmi_build_imap_query to handle
	properly multiple fields to be searched for simultaneously.
	* libbalsa/imap/imap-commands.c: adapt to changes in imap_write_key()
	* libbalsa/imap/imap-handle.c: move IS_ATOM_CHAR to imap_private.h
	* libbalsa/imap/imap_private.h: add this macro here.
	* libbalsa/imap/imap-handle.h: add searching for sizes and dates.
	* libbalsa/imap/imap-search.c: ditto.
	* src/main-window.c: extend the test.

2004-02-27 07:06  PeterB

	* src/main-window.c: don't free the condition used by find_real.
	* src/: balsa-index.c, balsa-index.h: use LibBalsaMailboxSearchIter
	and revise search code; remove unnecessary searches; remove
	"row-collapsed" signal handler.
	* libbalsa/: mailbox_imap.c, mailbox_local.c: new api for
	message_match class method; new search_iter_free class method for
	freeing backend-specific data.
	* libbalsa/: mailbox.c, mailbox.h: implement LibBalsaMailboxSearchIter:
	change api for libbalsa_mailbox_message_match;
	implement libbalsa_mailbox_search_iter_{new,free,step};
	remove libbalsa_mailbox_find.
	* libbalsa/filter-funcs.c: add missing lines (typos?).

2004-02-26  Abel Cheung  <maddog@linux.org.hk>

	* balsa.desktop: Fix badly encoded strings.

2004-02-26  Pawel Salek

	* libbalsa/imap/imap-commands.[hc]: add imap_mbox_filter_msgnos().
	* libbalsa/imap/imap-commands.c: 1. send 8-bit strings to servers
	without LITERAL+. 2. Send long queries right.
	* libbalsa/imap/imap-handle.c: Part two of 2.
	* libbalsa/imap/imap-search.c: Part two of 1.
	* src/main-window.c: Modify the search stress-tester.

2004-02-25  Pawel Salek

	* libbalsa/filter-funcs.c: add libbalsa_condition_new_string().
	* libbalsa/filter.[hc]: remove IMAP stuff which does not belong there.
	* libbalsa/mailbox_imap.c: build imap queries here - adapt to
	new 8-bit safe style.
	* libbalsa/imap/Makefile.am: add imap-search.c

	* libbalsa/imap/imap-commands.[ch]: adapt to new 8-bit safe searching
	style.
	* libbalsa/imap/imap-handle.c: move state macros to imap_private.h
	* libbalsa/imap/imap_private.h: 
	* libbalsa/imap/imap-handle.h: recognize more extensions.

	* src/main-window.c: add a demo for new matching code.

2004-02-22  Pawel Salek

	* libbalsa/imap-server.c: support SSL/imaps.
	* libbalsa/imap/imap-handle.[ch]: ditto.
	* libbalsa/imap/imap{-tls.c,_private.h}: share TLS/SSL routines.

2004-02-20 12:19  PeterB

	* src/sendmsg-window.c: use accessor function
	libbalsa_message_find_user_hdr() instead of accessing
	message->headers->user_hdrs directly.

2004-02-18  Pawel Salek

	* libbalsa/imap-server.c: compare agains a number of certificates.
	* libbalsa/imap/imap-tls.c: correctly check wildcard certificates.

2004-02-15 13:16  PeterB

	* src/main-window.c: get balsa_app.mblist_width and
	balsa_app.notebook_height from gtk_paned_get_position() instead of
	from allocation dimensions (avoids dimension creep when they're
	used in gtk_paned_set_position()).
	* libbalsa/: mailbox.c, mailbox_imap.c: revert yesterday's
	change--lock the mailbox in imap_flags_cb() instead of in
	libbalsa_mailbox_messages_status_changed().

2004-02-14  Pawel Salek

	* libbalsa/imap-server.c: store certificated accepted for the session.
	* libbalsa/mailbox_imap.c: use proper hierarchy delimiter.
	* libbalsa/server.c: handle NULL passwords.
	* src/balsa-index.c: do not try scrolling when no messages are present.
	* src/folder-conf.c: connect ask_password.

2004-02-14 07:17  PeterB

	* libbalsa/mailbox.c: lock mailbox while changing message flags.
	* libbalsa/body.c: check this body's id only if it has a mime-part.

2004-02-13 23:18  PeterB

	* libbalsa/send.c: prohibit smtp from sending Status and X-Status
	headers.
	* libbalsa/mailbox_pop3.c: set RECENT flag on incoming messages (as
	well as NEW).

2004-02-12  Pawel Salek

	* libbalsa/libbalsa.c: extra debugging for cert validation.
	* libbalsa/mailbox.c: use set_static_string() whenever possible.
	* libbalsa/message.c: 
	* src/balsa-message.c: delay "set_read()" as much as possible.
	* libbalsa/mailbox_imap.c: reduce RTT on open and on fetching new msgs.

2004-02-13 11:36  PeterB

	* libbalsa/mailbox_mbox.c: set msg_info.start as
	g_mime_parser_get_from_offset() instead of end of previous message
	(they can be different, if previous message has trailing garbage,
	like some sent by the Balsa list-server!).

2004-02-12 21:44  PeterB

	* libbalsa/mailbox_local.c, libbalsa/mailbox_local.h,
	libbalsa/mailbox_maildir.c, libbalsa/mailbox_mbox.c,
	libbalsa/mailbox_mh.c, src/main-window.c: remove
	LibBalsaMailboxLocal::msg_list.
	* libbalsa/mailbox_mbox.c: set message->msgno and message->mailbox
	when creating msg_info.message.

2004-02-11 21:48  PeterB

	* src/balsa-message.c: possible fix for bug #134173.
	* libbalsa/send.c: msg_queue_item_new() doesn't need to set
	LibBalsaMessage; use libbalsa_mailbox_get_message() instead of
	LIBBALSA_MAILBOX_LOCAL(outbox)->msg_list; lock/unlock only if
	BALSA_USE_THREADS.
	* libbalsa/mailbox_pop3.c: use libbalsa_mailbox_get_message()
	instead of LIBBALSA_MAILBOX_LOCAL()->msg_list.
	* libbalsa/mailbox_mbox.c: rewrite message status headers in place,
	if possible; use new GMime g_mime_parser_set_respect_content_length
	API to avoid bar From_ lines in libmutt mboxes; use only one
	GMimeStream to access mbox when syncing; fix interpretation of 'O'
	status flag ('O' => not recent).
	* libbalsa/mailbox_local.c: fix comment.
	* libbalsa/mailbox.c: check whether mailbox->msg_tree has been
	created.

2004-02-09  Pawel Salek

	* libbalsa/mailbox.c: be more careful when destroying msg_tree.
	Set holding_thread carefully.
	* libbalsa/message.c: first check, then thread.
	* libbalsa/imap/imap-commands.c: set unseen on reopening.
	* src/balsa-index.[ch]: scroll to last if no unseen.
	* src/main-window.[ch]: remove deadlocks in a brute way.

2004-02-08  Pawel Salek

	* libbalsa/mailbox.h: add first_unseen field.
	* libbalsa/mailbox_{imap,local}.c: add support for it.
	* src/balsa-index.[ch]: use it to scroll on open.
	* src/main-window.c: ditto.

2004-02-08 Darko Obradovic <dobradovic gmx.de>

	* src/main-window.c: fix 114041

2004-02-08  Pawel Salek

	Install as default mailer if requested by user (see bug 131606,
	closely based on the patch by Michael Petullo)
	* libinit_balsa/Makefile.am: add balsa-druid-page-defclient.[hc]

	* libinit_balsa/balsa-druid-page-{directory,finish,user,welcome}.c:
	* libinit_balsa/helper.c: remove 1.x remainings.
	* libinit_balsa/balsa-initdruid.c: plug in defuser page.
	* src/balsa-app.h: add default_client field.
	* src/main.c: update gconf data if requested.
	* src/save-restore.[hc]: implement config_defclient_save().

2004-02-07 18:08  PeterB

	* src/sendmsg-window.c: Steve Wall <balsa-user@wallfamily.us>;
	smarter choice of identity, better handling of signatures.

2004-02-07  Pawel Salek

	* libbalsa/mailbox.[hc]: do not sort/thread unless requested.
	Add persistent view filters.
	* libbalsa/mailbox_imap.c: modify accordingly.
	* libbalsa/mailbox_{local,maildir,mbox,mh}.c: ditto.
	* libbalsa/{message,send}.c: do not thread without need.
	* src/balsa-app.h: remove global view filter - do it per mailbox.
	* src/main-window.[hc]: support for per-mailbox view filters.
	* src/save-restore.c: config support for that.

	(part 2)
	* src/main-window.c: (msg) thread in (p)thread without gdk lock
	* libbalsa/mailbox.c(lbm_threads_enter): support for nested gdk locks.
	* libbalsa/mailbox_imap.c, libbalsa/imap/imap_commands.[hc]:
	obey the namespace rules.
	
2004-02-06 05:20  PeterB

	* libbalsa/mailbox_mbox.c: change parser to check for start < end
	before adding message; make sure message is terminated with '\n',
	and add one blank line before From_ line; remove dead code; remove
	Content-Length headers when armoring; pop up warnings when
	add_message fails.

2004-02-04  Pawel Salek

	* libbalsa/folder-scanners.[hc]: add IMAP error handling.
	* libbalsa/imap-server.c: show more info when certificate verify fails.
	* libbalsa/libbalsa.c: ditto.
	* libbalsa/libbalsa.h: try introducing GError to libbalsa.
	* libbalsa/misc.c: fix libbalsa_expand_path() and sig problem.
	* libbalsa/imap/imap-handle.c: error handling.
	* src/mailbox-node.c: receive GError.

2004-02-04 09:00  PeterB

	* libbalsa/mailbox.c: simplify handling of unread message count and
	flag.
	* libbalsa/imap-server.c, libbalsa/imap-server.h, src/main.c:
	implement --debug-imap (-D) switch to control monitoring imap
	server dialog.

2004-02-03  Pawel Salek

	* libbalsa/imap-server.c: store accepted certificates.
	* libbalsa/libbalsa.c: small fixes to the verification dialog.
	* libbalsa/send.c: cleanup.
	* libbalsa/imap/imap-handle.c: improve RFC2595 conformance.
	* libbalsa/imap/imap-tls.c: ditto.
	* libbalsa/imap/imap-handle.h: add using_tls field.
	* libbalsa/imap/imap.h: add IMAP_UNSECURE result.

2004-02-03 00:07  PeterB

	* libbalsa/mailbox_imap.c: update unread_messages when server
	notifies us about a change in LIBBALSA_MESSAGE_FLAG_NEW.

2004-02-02 08:34  PeterB

	* libbalsa/mailbox_pop3.c: use rmdir to remove temp mailbox.

2004-02-01  Pawel Salek

	(correcting myself)
	* libbalsa/libbalsa.h: fix the build ---disable-threads
	* libbalsa/imap/imap-tls.c: same.
	* libbalsa/imap/auth-cram.c: initialize pointers.

2004-02-01  Pawel Salek

	* libbalsa/imap-server.c: try harder on failed cert verification.
	* libbalsa/libbalsa.[ch]: convert UI of cert v-fy to the new code.
	* libbalsa/imap/imap-tls.c: fix SSL threading. Improve server v-fy.

2004-02-01  Robert Sedak  <robert.sedak@sk.htnet.hr>

        * configure.in: Added "hr" (Croatian) to ALL_LINGUAS.

2004-02-01 10:06  PeterB

	* libbalsa/: address-entry.c, address-entry.h: streamline includes.
	* libbalsa/address-entry.c: replace control characters with spaces;
	fill input after button press event (should fix vanishing
	addresses); don't add null addresses to list.

2004-01-28  Pawel Salek

	* libbalsa/imap/imap-commands.c: temporary workaround for
	appending messages containing NUL characters.

2004-01-28 23:53  PeterB

	* libbalsa/: mailbox_local.c, mailbox_local.h, mailbox_maildir.c,
	mailbox_mbox.c, mailbox_mh.c, message.c, message.h: make
	GMimeMessage for mbox only when needed; implement
	fetch_message_structure method for mbox; populate message headers
	for mbox at parse time instead of load-message time; move release
	method from local backends to LibBalsaMailboxLocal; add separate
	GMimeMessage argument to libbalsa_message_headers_update.
	* libbalsa/mailbox_pop3.c: use a local variable instead of dynamic
	cast.
	* libbalsa/pop3.c: copy uid to caller's buffer only if it's valid.
	* libbalsa/imap/: imap-commands.c, imap-handle.h: implement
	imap_mbox_find_unseen(): gets the list and count of unseen
	messages.
	* libbalsa/mailbox_imap.c: implement lbm_imap_get_unseen(): gets
	unread messages and sets mailbox->unread_messages and
	mailbox->has_unread_messages.

2004-01-25 20:25  PeterB

	* libbalsa/imap/imap-tls.c: compile with threads disabled.
	* libbalsa/source-viewer.c: plug memory leak.
	* libbalsa/address-entry.c, libbalsa/send.c, src/balsa-mblist.c,
	src/main.c, src/sendmsg-window.c: plug memory leaks.

2004-01-25  Pawel Salek

	Do not store authorization data in ImapMboxHandle.
	* libbalsa/imap-server.c: make imap alerts work with balsa.
	* libbalsa/mailbox.c: stick to C comment style.
	* libbalsa/mailbox_imap.c: decode attachment names. clean cache.

	* libbalsa/imap/auth-cram.c: use user_cb to get whatever
	authorization data is needed.
	* libbalsa/imap/imap-auth.[hc]: same.	
	* libbalsa/imap/imap{-handle.c,_private.h}: remove user/pass fields.
	* libbalsa/imap/imap-tls.c: get user acceptance.
	* src/information-dialog.[hc]: display messages in the status bar.
	* src/pref-manager.c: configure this.
	
2004-01-25 10:14  PeterB

	* src/: balsa-app.c, balsa-app.h, balsa-mblist.c, pref-manager.c,
	save-restore.c: use bold and oblique names to indicate mailboxes
	with unread mail and folders containing such mailboxes,
	respectively; remove all support for balsa_app.mblist_unread_color.

2004-01-24 13:01  PeterB

	* src/: balsa-message.c, balsa-message.h: BalsaMessage can subclass
	GtkNotebook--no need for a container.
	* src/balsa-message.c: connect only to widget signals, so they are
	disconnected automatically when widget is destroyed.
	* libbalsa/mailbox.c, libbalsa/mailbox.h, src/balsa-index.c: New
	mailbox column LB_MBOX_STYLE_COL, which is PANGO_STYLE_OBLIQUE for
	a message with unread children.

2004-01-23 00:36  PeterB

	* libbalsa/body.c: Make sure subject in embedded header is valid
	utf-8.
	* src/balsa-message.c: set message background correctly for all
	known themes; reset header colors when theme is changed.

2004-01-22 16:43  PeterB

	* libbalsa/mailbox_mbox.c: check for new messages before syncing;
	escape "From " lines when rewriting mailbox.

2004-01-22  Pawel Salek

	* configure.in: add USE_TLS flag for compatibilty with libesmtp.
	* libbalsa/libbalsa.c: compile --with-ssl
	* libbalsa/mailbox.c: remove false warnings.
	* libbalsa/imap/Makefile.am: add imap-tls.c

	* libbalsa/imap/imap-commands.c: update manually flags when doing
	Flags.Silent.
	* libbalsa/imap/imap-commands.h: add imap_handle_starttls().
	* libbalsa/imap/imap-handle.c: use TLS when available.
	* libbalsa/imap/siobuf.[hc]: merge updates from libesmtp.
	* src/balsa-app.[hc]: cleanup libmutt remainings.
	* src/main.c: ditto.
	* src/main-window.c: remove debugging output.
	
2004-01-22 06:14  PeterB

	* libbalsa/message.c: Make sure subject is valid utf-8.

2004-01-21 15:03  PeterB

	* src/message-window.c: Add `next unread' item to message menu with
	ctrl+N binding, and manage its sensitivity; add zoom controls for
	html parts.
	* src/balsa-message.c: In a multipart message, make current_part
	the part that's actually shown instead of the multipart parent.

2004-01-20 16:59  PeterB

	* src/balsa-index.c: expand tree on opening, if requested.
	* src/main-window.c: frame the paned contents.

2004-01-19 22:41  PeterB

	* src/: balsa-message.c, balsa-message.h: make BalsaMessage
	subclass GtkVbox instead of GtkViewport--no need for scrollbars
	since it became a notebook, and the frame is just visual clutter.
	* src/balsa-message.c: use macros to access header text and message
	content widgets; set border and background colors of header widget
	from theme colors; set background of message to base of message
	text, even with pixmap themes.
	* src/balsa-index.c: disable experimental code.
	* libbalsa/mailbox.c: move declarations to start of block; check
	that tree-view widget is realized.
	* src/sendmsg-window.c: show window before setting `From:' address,
	so its text doesn't get selected.

2004-01-18  Pawel Salek

	* libbalsa/html.c: compile against libgtkhtml2.
	* libbalsa/imap-server.c: remove servers from hash on finalize.
	* libbalsa/address.c: set fallback charset globally.
	* libbalsa/mailbox.c: ditto. Make iterators work correctly even
	for closed mailboxes.
	* libbalsa/mailbox_imap.c: sanitize subjects.
	* libbalsa/mailbox_mbox.c: keep quiet if you have nothing to say.
	* libbalsa/misc.[hc]: support for setting fallback codeset.
	* libbalsa/rfc3156.c: adjust apriopriately.
	* libbalsa/source-viewer.c: same.
	* src/{balsa-message,pref-manager,print,save-restore,sendmsg-window}.c:
	ditto.

2004-01-17 16:40  PeterB

	* src/balsa-message.c: implement and use bm_message_widget to
	create the main message and to put a frame around an embedded
	message; set the background style of the view-port instead of using
	an event-box.

2004-01-15 22:13  PeterB

	* src/: balsa-message.c, balsa-message.h: Nest embedded messages
	with increasing border width.
	* src/balsa-message.c: Set embedded headers in the same style of
	widget as message headers.

2004-01-14 17:53  PeterB

	* src/balsa-bonobo.c: use new api for add_attachment.
	* src/: main.c, sendmsg-window.c, sendmsg-window.h: fix GNOME
	bugzilla #126379: show attachments when invoked with `-a' (Mike
	Petullo <mike@flyn.org>).

2004-01-14 09:43  PeterB

	* src/balsa-index.c: Use balsa_index_selected_list instead of
	gtk_tree_selection_get_selected_rows to view message source: it's
	simpler and doesn't introduce a dependence on gtk+-2.0 version
	2.2.x.
	* libbalsa/mailbox_mh.c: Use libbalsa_str_has_prefix for
	compatibility with older glib-2.0.
	* libbalsa/mailbox.c: Suppress some debugging messages.
	* libbalsa/: misc.c, misc.h: Implement libbalsa_str_has_prefix as a
	compatibility wrapper for g_str_has_prefix.
	* configure.in: Check whether we have glib-2.0 version 2.2.0 or
	newer.

2004-01-13 23:45  PeterB

	* libbalsa/mailbox.c: Flag partial messages so we don't keep making
	the whole message.
	* src/print.c: Use GMime filter to print text/enriched and
	text/richtext parts as html.
	* src/balsa-message.c: Detect when GMime can filter text/enriched
	and text/richtext; use libbalsa_mailbox api; use g_list_free1() to
	free a list of one item.
	* src/balsa-index.c: Plug a memory leak.
	* configure.in, libbalsa/html.c, libbalsa/html.h, libbalsa/mime.c:
	Detect when GMime can filter text/enriched and text/richtext.
	* libbalsa/message.c, src/sendmsg-window.c: Keep references in the
	correct order.

2004-01-11  Pawel Salek

	* Makefile.am: add intltool-*.in to EXTRA_DIST
	* NEWS: release 2.1.0
	* balsa.spec.in: wrap gmime in.
	* libbalsa/libbalsa.c: clear some libmutt remainings.

	* libbalsa/mailbox_imap.c: set address to null if strings are null
	for consistency with the rest of balsa.
	* src/Makefile.am: add Balsa.idl to EXTRA_DIST.
	* src/main-window.c: update author list.

2004-01-11 15:54  PeterB

	* libbalsa/: mailbox.c, mailbox.h, mailbox_imap.c, mailbox_local.c,
	message.c, message.h, imap/imap-commands.c, imap/imap-handle.c,
	imap/imap-handle.h: add GMimeContentType *content_type member to
	LiBBalsaMessageHeaders and remove related gboolean members from
	LiBBalsaMessage; fix libbalsa_message_set_header_from_string(); use
	BODY.PEEK[HEADER.FIELDS (CONTENT-TYPE)] to get content-type for
	imap messages; untested support for message/partial.
	* src/balsa-message.c: Plug a memory leak; allow 2-pixel motion
	tolerance when activating a URL.

2004-01-11  Pawel Salek

	* libbalsa/filter-funcs.[hc]: fix remaining problems with
	converting LibBalsaCondition to/from string.
	* src/filter-edit-{callbacks,dialog}.c: edit conditions correctly.
	* src/save-restore.c: append filters to the filter list.

	* libbalsa/mailbox_imap.c: enable server-side copy under certain
	conditions.
	* libbalsa/imap/imap-commands.[hc]: add imap_mbox_handle_copy().

2004-01-10 05:28  PeterB

	* libbalsa/mailbox.c, libbalsa/mailbox.h, libbalsa/mailbox_imap.c,
	libbalsa/mailbox_local.c, libbalsa/mailbox_maildir.c,
	libbalsa/mailbox_mbox.c, libbalsa/mailbox_mh.c,
	libbalsa/mailbox_pop3.c, libbalsa/send.c, src/balsa-mblist.c,
	src/main-window.c, src/message-window.c: Replace total_messages
	member of LibBalsaMailbox with libbalsa_mailbox_total_messages();
	add total_messages method to LibBalsaMailboxClass and implement in
	backends.

2004-01-09 06:11  PeterB

	* libbalsa/imap/imap-handle.c: Free all of ImapAddress.
	* libbalsa/mime.c: Don't assume body has a mime-part.

2004-01-07 19:15  PeterB

	* libbalsa/mailbox_imap.c: Fix last commit.
	* src/balsa-mblist.c: new_messages member has gone away.
	* src/balsa-index.c: Don't connect to column "clicked"; remove
	callback and simplify helpers; use LibBalsaMailboxColumn enum.
	* libbalsa/send.c: Rethread after copying to fccbox.
	* libbalsa/message.c: Rethread destination after moving and copying
	messages.
	* libbalsa/mailbox_pop3.c: messages member has gone.
	* libbalsa/mailbox_mh.c: messages and new_messages members have
	gone; leave inserting message to the check method.
	* libbalsa/mailbox_mbox.c: new_messages and messages members have
	gone.
	* libbalsa/mailbox_maildir.c: Add load_config method for setting
	curdir and newdir members; messages and new_messages members have
	been dropped; leave inserting a new message to the check method.
	* libbalsa/mailbox_local.h: Change api for load_message class
	method and libbalsa_mailbox_local_load_messages().
	* libbalsa/mailbox_local.c: Move message init from
	libbalsa_mailbox_local_load_messages() to
	libbalsa_mailbox_local_load_message(); add msgno argument to
	libbalsa_mailbox_local_load_message(); use
	libbalsa_mailbox_msgno_filt_{in,out}.
	* libbalsa/: mailbox.c, mailbox.h: Drop redundant sort_column_id
	and order members, and use view->sort_field and view->sort_type
	instead; drop messages and new_messages members;
	libbalsa_mailbox_set_msg_tree() and lbm_update_msg_tree() must
	handle a new tree with different messages from the current tree.

2004-01-06  Pawel Salek

	* libbalsa/mailbox.[ch]: add libbalsa_mailbox_change_msgs_flags()
	to change many flags of many messages in one transaction. Fix
	handling of "deleted" flag in
	libbalsa_mailbox_messages_status_changed().

	* libbalsa/mailbox_imap.c: subclass it for IMAP - particularly
	important! lbm_imap_construct_body(): set ::filename in the same
	way as GMime does. Create message structure in same way as the
	rest of balsa does.

	* libbalsa/message.c: use change_msgs_flags().

	* libbalsa/imap/imap-commands.c: support for change_msgs_flags().
	Sort by MSGNO for filtered views.
	* libbalsa/imap/imap.h: add IMSO_MSGNO enum.
	* libbalsa/imap/imap-handle.c: make mbox_view_append_no() visible.
	
2004-01-06 15:38  PeterB

	* src/balsa-message.c: Show and hide the appropriate widgets.

2004-01-04  Carlos Morgado  <chbm gnome.org>

	* src/balsa-bonobo.c: 
	* src/main.c: 
	implement the other cli options

2004-01-04  Pawel Salek

	* libbalsa/mailbox.[hc]: add filt_in and filt_out methods in an
	attempt to filter in and out message.
	* libbalsa/mailbox_imap.c: do not mix sorting with threading - too
	slow.
	* libbalsa/message.h: do not waste flag bits.
	* src/balsa-index.c: unbreak message searching.
	* src/balsa-message.[hc]: bug 127776.

2004-01-04  Francisco Javier F. Serrador  <serrador@cvs.gnome.org>

	* src/main.c: Fixed typo staartup-->startup	

2004-01-04  Carlos Morgado  <chbm gnome.org>

	* src/Balsa.idl: 
	* GNOME_Balsa.server.in: 
	Balsa_Application
	
	* src/balsa-bonobo.h: 
	* src/balsa-bonobo.c: 	
	* src/main.c: 
	implement -c
	
2004-01-03  Pawel Salek

	* libbalsa/filter-funcs.c: implement {append,get}_quoted_string()
	that were missing.
	* libbalsa/filter.c: make nicer IMAP queries.
	* libbalsa/imap-server.[hc]: fix connection caching for servers
	without UNSELECT broken in last commit.
	* libbalsa/mailbox.[ch]: add update_view_filter() method.
	* libbalsa/mailbox_{imap,local}.c: implement it.
	* libbalsa/imap/imap-commands.c: fix returning failure codes.
	* libbalsa/imap/imap-handle.c: matching part.
	* src/balsa-app.h, : add view_filter field.
	* src/balsa-index.c: 
	* src/main-window.[ch]: save view filters.
	* src/save-restore.c: ditto.
	
2004-01-01  Pawel Salek

	* libbalsa/filter-file.c: remove old LibBalsaCondition config IO.
	* libbalsa/filter-funcs.c: more compact string representation of
	match keys. 
	* libbalsa/filter-funcs.h: renamed filed adjustments.
	* libbalsa/filter.[hc]: just compile the code.
	* libbalsa/imap-server.c: reuse connections better(?).
	* libbalsa/libbalsa.h: add LibBalsaCondition typedef.
	* libbalsa/mailbox.[ch]: make libbalsa_mailbox_set_view_filter()
	work.
	* libbalsa/mailbox_imap.[hc]: view-related changes.
	* libbalsa/imap/imap-commands.[hc]: add imap_mbox_unselect() and
	imap_sort_filter(),
	* libbalsa/imap/imap-handle.[hc]: expand the IMAP extension list.
	* src/balsa-index.[hc]: view-related changes.
	* src/filter-edit-{callbacks,dialog}.c:
	* src/filter-run-callbacks.c: LibBalsaCondition related changes.
	* src/main-window.c: filter-related changes.
	* src/pref-manager.c: remove hide-deleted from here.
	* src/save-restore.c: ditto.
	
2004-01-01  Carlos Morgado  <chbm gnome.org>

	* libbalsa/html.c: 
	fix build glitch

2003-12-31 08:30  PeterB

	* libbalsa/: html.c, html.h: Provide wrappers to insulate the rest
	of Balsa from the differences between the gtkhtml[23] APIs.
	* src/print.c: Use new html api for printing; use only
	libbalsa_message_body_get_content_type() to get content-type.
	* src/main-window.c: Use copy-text capability of gtkhtml3, when
	installed; compile without gtkhtml.
	* src/: balsa-message.c, balsa-message.h: Use new html api; support
	text/enriched and text/richtext.
	* libbalsa/misc.c: Use select-all capability of gtkhtml3 when
	installed.
	* libbalsa/mime.c: Support text/enriched and text/richtext;
	include text of html parts when replying; plug a memory leak.
	* libbalsa/mailbox_mbox.c: g_mime_content_type_is_type() doesn't
	match "*" in main part of type.
	* libbalsa/Makefile.am: Add html.[ch] to dependencies.
	* configure.in: Detect gtkhtml3 if installed in preference to
	gtkhtml2, when --enable-gtkhtml is used.

2003-12-26 15:52  PeterB

	* src/balsa-index.c: More care needed with new threading and sync.
	* libbalsa/: mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c: Queue
	sync after changing flags.
	* libbalsa/: mailbox_local.c, mailbox_local.h: Thread msg_tree in
	place; sync in idle handler after changing flags.
	* libbalsa/mailbox_imap.c: After threading, use
	libbalsa_mailbox_set_msg_tree() to set the new tree; allow sorting
	with threading.
	* libbalsa/: mailbox.c, mailbox.h: Lookup and cache GtkTreeModel
	signals; setup mailbox when opening instead of at init time; thread
	after adding or moving messages; implement and use
	lbm_threads_leave(); allow for sync in an idle handler;
	lock mailbox when threading; implement and use lightweight
	mbox_model_get_path_helper(); add helpers for subclass threading
	methods.
	* libbalsa/imap-server.c: Don't skip the next handle when deleting
	one.

2003-12-23  Carlos Morgado  <chbm gnome.org>

	* src/balsa-bonobo.c (impl_balsa_composer_sendMessage): 
	bonobo reclaims its buffers (duh) - unbreak balsa -m

2003-12-20 08:04  PeterB

	* libbalsa/mailbox_mbox.c: Reuse LibBalsaMessageBody when reparsing
	during sync.
	* libbalsa/body.c: Use existing LibBalsaMessageBody, if any, when
	setting mime-body; do libbalsa_message_body_set_mime_body() in
	steps.

2003-12-16 19:47  PeterB

	* src/balsa-index.c: Use LibBalsaMailbox's "changed" signal; remove
	style-setting code (style should be set by LibBalsaMailbox).
	* libbalsa/send.c: Set the charset of a "text/*" attachment as
	"us-ascii" if it's all 7-bit, or "utf-8" if it validates, else
	retype as "application/octet-stream"; plug address-related memory
	leaks.
	* libbalsa/mailbox_mbox.c: Encode text parts as quoted-printable
	and escape "From " lines.
	* libbalsa/mailbox_local.c: Use LibBalsaMailbox's "changed" signal.
	* libbalsa/: mailbox.c, mailbox.h: Replace "messages-added" signal
	with a general-purpose "changed" signal, and emit when messages
	might have been expunged.
	* src/balsa-app.c: Remove imap keep-alive code--it's now handled by
	LibBalsaImapServer.
	* libbalsa/mailbox_imap.c: Remove unnecessary mailbox locking.
	* libbalsa/imap-server.c: Keep active connection alive; use
	client-side of monitor to track activity; use a subthread without
	gdk lock to avoid confusing libbalsa_mailbox_msgno_changed; plug
	memory leak in force-disconnect.

2003-12-16  Carlos Morgado  <chbm gnome.org>

	* src/balsa-bonobo.c (Message): 
	* src/main.c (Message): 
	-a works, change behaviour on first -m invocation. 
	maybe the old behaviour was better.
	
2003-12-15  Carlos Morgado  <chbm gnome.org>

	* GNOME_Balsa.server.in (Repository): 
	* Makefile.am (Message): 
	* src/main.c (Message): 

	* src/balsa-bonobo.h (Message): 
	* src/balsa-bonobo.c (Message): 
	* src/Makefile.am (Message): 
	
	implement new_message bonobo interface and use it. 
	balsa no longer spawns a new process for balsa -m.
	you must make install to make the .server file make it's way to 
	/usr/lib/bonobo/servers
	
2003-12-10 15:45  PeterB

	* src/message-window.c: Idle handler must return FALSE (Nuno
	Monteiro <nuno@itsari.org>); manage sensitivity of next-flagged
	button, too.

2003-12-09 10:37  PeterB

	* libbalsa/mailbox.c: Keep the tree-view better informed about
	changes in the mailbox.
	* src/: balsa-index.c, message-window.c: Always mark current
	message as read when user selects "next" anything.

2003-12-08 22:36  PeterB

	* src/message-window.c: Set a new message in the same
	message-window, instead of destroying it and creating a new one.

2003-12-07 19:38  PeterB

	* src/message-window.c: Manage sensitivity of next-unread toolbar
	button.

2003-12-02 15:26  PeterB

	* libbalsa/body.c: Unref the message returned by
	g_mime_message_part_get_message(); simplify set-mime-body
	recursion.
	* src/balsa-message.c: Display message/rfc822 (Pawel); simplify
	display-part recursion.

2003-12-01 20:42  PeterB

	* libbalsa/body.c: Store the content of a message/rfc822 message
	part as its child, not its sibling.
	* libbalsa/body.c: Treat message_part->mime_part as inline if it's
	a GMimePart.

2003-11-29  Pawel Salek

	* libbalsa/body.c: we can save msg body without mime_part.
	* libbalsa/mailbox_imap.c: translate msg structure in the same way
	the other drivers do. Fix caching of nested parts and memory leaks.

2003-11-23  Pawel Salek

	* libbalsa/mailbox_imap.c: fix memory leak.
	* libbalsa/imap/imap-handle.c: parameters are case-insensitive.

2003-11-26 12:15  PeterB

	* src/balsa-message.c: Handle nested multipart messages.
	* libbalsa/body.c: Ignore trailing characters in
	Content-Disposition.

2003-11-24 23:55  PeterB

	* libbalsa/body.c: Get a file descriptor for body->temp_filename,
	even when it has suffices.
	* libbalsa/body.c: Content of message/rfc822 is next part, not
	child part.

2003-11-24  Carlos Morgado  <chbm gnome.org>

	* src/main.c: remove Balsa.h dep for now

2003-11-24 14:42  PeterB

	* libbalsa/: mailbox.c, mailbox_imap.c, mailbox_local.c: Remove
	some now-redundant g_mime_stream_set_bounds() calls.
	* libbalsa/imap/: imap-commands.c, imap-commands.h: Add length
	argument to imap_mbox_append_stream().
	* libbalsa/: mailbox.c, mailbox_maildir.c, mailbox_mbox.c,
	mailbox_mh.c: Ref/unref the message in
	libbalsa_mailbox_copy_message() instead of the subclass method.
	* libbalsa/mailbox_imap.c: Write message to a temp file, so we can
	pass its length to imap_mbox_append_stream(); ref/unref the message
	in libbalsa_mailbox_copy_message() instead of the subclass method.

2003-11-23  Carlos Morgado  <chbm gnome.org>

	* src/main.c: 
	* src/balsa-bonobo.h: 
	* src/balsa-bonobo.c: 
	* src/Makefile.am:
	one more small step 

2003-11-23 14:40  PeterB

	* libbalsa/mailbox.c: Mark mailbox as unsorted and invalidate iters
	when really closing.

2003-11-23  Pawel Salek

	* libbalsa/libbalsa.c: make the mailbox_lock recursive.
	* libbalsa/libbalsa_private.h, src/main.c: ditto.
	* libbalsa/mailbox.[hc]: continue filtered view implementation.
	* libbalsa/mailbox_imap.c: remove debugging output.

	* libbalsa/imap/{auth-cram,imap-auth,imap-commands,imap-handle}.c:
	allow for nested IMAP command execution.
	* libbalsa/imap/imap-handle.h: cleanup prototypes.
	* libbalsa/imap/imap_private.h: add cmd_queue and tasks lists.
	* src/balsa-index.c: preleminary call to filter_view().
	* src/main-window.c: alternative ui for view filtering.

2003-11-23 11:22  PeterB

	* libbalsa/mailbox.c: Before removing a node from the msg_tree,
	promote its children to be children of its parent.

2003-11-21 Darko Obradovic <dobradovic gmx.de>

	* src/balsa-app.h: set MAX_QUOTED_COLOR to 2.
	* src/pref-manager.c: simplify preferences.
	* src/save-restore.c: adjust accordingly.

2003-11-21 10:14  PeterB

	* src/balsa-mblist.c: Fix bug 127422.

2003-11-19 05:02  PeterB

	* src/balsa-index.c: Unref mailbox_node even when it has no
	mailbox.
	* libbalsa/send.c: Use the basename of the file path, not the full
	path, as the filename for the mime_part.
	* libbalsa/body.c: Set body->filename from mime_part.

2003-11-18 22:07  PeterB

	* libbalsa/send.c: Encoding goes on mime_part, not content.
	* libbalsa/send.c: Simplify call to
	libbalsa_message_create_mime_message(); call it when postponing,
	and save fcc in X-Balsa-Fcc header.
	* libbalsa/message.c: Get fcc_url from X-Balsa-Fcc header.
	* src/balsa-index.c: Clear index->current_message when destroying
	the index, as the destroy method seems to be called more than once.

2003-11-17 20:02  PeterB

	* libbalsa/mailbox.c, libbalsa/mailbox_local.c, libbalsa/message.c,
	src/balsa-index.c: Link DELETED messages into the mailbox;
	LIBBALSA_MESSAGE_FLAG_DELETED conceals other flags.

2003-11-18  Carlos Morgado  <chbm gnome.org>

	* configure.in: 
	* src/Makefile.am: 
	bonobo/ORBit stuff	

	* GNOME_Balsa.server.in.in: there should be a factory definition 
	around here somewhere. hum.

2003-11-17  Carlos Morgado  <chbm gnome.org>

	* src/balsa-bonobo.h (Repository): 
	* src/balsa-bonobo.c (Repository): 
	* src/Balsa.idl (Repository):
	new interface, Evo style doesn't fit us

	* idl/balsa.idl (Repository): 
	* idl/balsa-composer.idl (Repository): 
	made no sense being here
	

2003-11-17 08:23  PeterB

	* src/balsa-index.c: Rename message_status_changed_cb as
	bndx_row_changed_cb; use "row-changed" signal instead of
	"messages-status-changed", which may be emitted without the gdk
	lock; remove obsolete "messages-removed" signal handler.
	* libbalsa/message.c: Set flags before notifying the mailbox--the
	mailbox in turn triggers a UI change which needs the new flags.
	* libbalsa/mailbox_local.c: Cleanup.
	* libbalsa/: mailbox.c, mailbox.h: Remove obsolete
	"messages-removed" signal.

2003-11-16 20:09  PeterB

	* src/balsa-index.c: Select another message when current message is
	flagged as deleted.
	* libbalsa/message.c: Don't lock mailbox when looking up message
	properties.

2003-11-16  Carlos Morgado  <chbm gnome.org>

	* src/balsa-bonobo.h:
	* src/balsa-bonobo.c:
	* idl/balsa.idl:
	* idl/balsa-composer.idl:
	* src/main.c: 
	bonoboizaiton - lacking server implementation, makefiles

2003-11-15 07:41  PeterB

	* src/main-window.c: Add a weak pointer to window->current_message.
	* libbalsa/mailbox.c: Grab the gdk lock before invalidating mailbox
	iters.

2003-11-14 22:11  PeterB

	* src/sendmsg-window.c: Test for empty <> in address.
	* libbalsa/misc.c: Clear error in loop.
	* libbalsa/mailbox_maildir.c: Plug a memory leak; move a test to
	where it's really needed.
	* libbalsa/mailbox_mbox.c: Expunge deleted messages even if flags
	haven't changed.
	* libbalsa/: mailbox.c, mailbox.h: Implement
	libbalsa_mailbox_msgno_find()--gets an iter and a path for a given
	message number.
	* src/: balsa-index.c, balsa-index.h: Remove ref_table member; use
	libbalsa_mailbox_msgno_find() in bndx_find_message(); remove weak
	pointers when we don't need them.

2003-11-13 21:45  PeterB

	* libbalsa/: mailbox.c, mailbox_imap.c, mailbox_maildir.c,
	mailbox_mbox.c, mailbox_mh.c: Fix pop3 checking, broken in change
	on 2003-11-11.
	* libbalsa/send.c: Attach the created GMimeMessage to the
	LibBalsaMessage; don't grab the gdk lock while enumerating smtp
	messages.
	* libbalsa/misc.c: Free only a non-NULL error.
	* libbalsa/mailbox.c: Implement GtkTreeDragSource
	interface--trivial, but necessary to support dnd.

2003-11-12 16:26  PeterB

	* src/balsa-message.c: Ref widget when passing to idle handler.
	* libbalsa/message.c: Message now owns mime message.
	* libbalsa/: mailbox_maildir.c, mailbox_mh.c: Message owns mime
	message, not the mailbox structure; restore chaining up in close
	method.
	* libbalsa/mailbox_mbox.c: Unref message when removing it from
	mailbox structure; restore chaining up in close method; message
	takes over ownership of mime message.
	* libbalsa/mailbox_imap.c: Update total_messages in EXISTS
	callback; compare count with mimap->messages_info->len instead of
	total_messages; combine signal disconnections into one.
	* libbalsa/mailbox.c: Give a milder warning when msgno is not
	found.
	* libbalsa/body.c: Get Content-Disposition using
	g_mime_object_get_header().
	* libbalsa/mailbox_imap.c: Update total_messages on expunge;
	disconnect signal handlers before releasing handle.
	* libbalsa/imap/imap-handle.c: Use correct error code.

2003-11-11 12:45  PeterB

	* libbalsa/: mailbox.c, mailbox_imap.c, mailbox_maildir.c,
	mailbox_mbox.c, mailbox_mh.c: Move more checking and locking from
	subclasses to mailbox.c; clear message->mailbox when closing
	mailbox.
	* libbalsa/mailbox_mh.c: Fix editing error.
	* libbalsa/send.c, src/balsa-mblist.c, src/mailbox-node.c,
	src/main-window.c: Use MAILBOX_OPEN() macro.
	* libbalsa/: mailbox_local.c, mailbox_local.h:
	libbalsa_mailbox_local_load_messages() is now called with mailbox
	locked; implement new helper
	_libbalsa_mailbox_local_get_message_stream()--common code from
	maildir and mh.
	* libbalsa/: mailbox.c, mailbox_imap.c, mailbox_maildir.c,
	mailbox_mbox.c, mailbox_mh.c: Move locking and open-mailbox checks
	from subclasses to mailbox.c.

2003-11-10 11:57  PeterB

	* libbalsa/: mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c: Don't
	expunge when _sync is called with expunge == FALSE.
	* src/balsa-index.c: Unset mailbox as the index's tree-model before
	closing the mailbox.
	* libbalsa/mailbox_imap.c: Ping mailbox only if it's connected.
	* libbalsa/: mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c:
	Really close only when open_ref == 0.

2003-11-09  Pawel Salek

	* libbalsa/mailbox_imap.c: be careful when doing noop.
	* libbalsa/message.[ch]: clean up message changing code.
	* libbalsa/send.c: ditto.
	* src/balsa-index.[ch]: adapt to changed API. 
	Fix crash on expunging messages in hidden mailbox.
	* src/{main,sendmsg}-window.c: ditto.

2003-11-07 00:23  PeterB

	* libbalsa/mailbox_mh.c: Find last_fileno when adding a message to
	a closed mailbox; save last_fileno after adding.

2003-11-06 23:45  PeterB

	* libbalsa/: mailbox_mh.c, mailbox_mh.h: Rework with a message hash
	table instead of a sparse array.
	* libbalsa/mailbox_mbox.c: Notify tree-model promptly when a
	message is removed from the mailbox's internal structures.

2003-11-05  Pawel Salek

	* libbalsa/mailbox.c: compile with --disable-threads.
	* libbalsa/mailbox_imap.c: do not deadlock in imap_sync().
	* src/balsa-index.c: clean up message_status_changed() - it is almost
	redundant now.

2003-11-04 16:25  PeterB

	* src/main-window.c: Check for unreffed mbnode.
	* libbalsa/mailbox_mbox.c: Build removed_list carefully.
	* libbalsa/mailbox.c: Grab gdk lock before emitting signal to a
	GtkTreeView.
	* libbalsa/mailbox_mbox.c: Give lbm_mbox_sync_real() a `closing'
	argument instead of `reparse', for consistency; drop a local
	variable; no need to check
	LIBBALSA_MAILBOX_CLASS(parent_class)->close_mailbox.
	* libbalsa/mailbox_maildir.c: Expunge on close.
	* libbalsa/mailbox_maildir.c: Close the mailbox with a
	close_mailbox method instead of close_backend; implement
	parse_mailbox_subdirs() helper; build list of removed messages when
	syncing, renumber higher-numbered messages, and notify the
	tree-model.
	* libbalsa/mailbox_local.c: Populate the msg_tree only with
	messages in the msg_list; allocate the msg_array enough space to
	store the highest numbered message.

2003-11-02 20:29  PeterB

	* libbalsa/mailbox_mbox.c: Remove close_backend method and
	reinstall it as close_mailbox; make mbox_sync a local helper with a
	'gboolean reparse' option; call it with reparse = FALSE in
	close_mailbox, to update the mailstore, and with reparse = TRUE in
	the new mbox_sync.
	* libbalsa/mailbox.c: Install default (noop) method for
	close_backend; modify msg_tree before getting a path for a new
	node; lock mailbox when syncing.

2003-11-02  Pawel Salek  <pawsa theochem.kth.se>

	* libbalsa/mailbox_imap.c: smarter envelope prefetching.
	* libbalsa/imap/imap-commands.[hc], imap-handle.h: 
	implement imap_mbox_handle_fetch_set().

2003-11-01  Pawel Salek  <pawsa theochem.kth.se>

	* libbalsa/mailbox.[hc]: move SortTuple to header file.
	* libbalsa/mailbox_imap.c: enable server side sorting.
	* libbalsa/imap/imap-commands.[ch]: some support in the library.
	* libbalsa/imap/imap-handle.h: add asc/desc flag.
	* libbalsa/imap/imap.h: add more sorting keys.

2003-10-31  Pawel Salek  <pawsa theochem.kth.se>

	* libbalsa/server.c: make sure LibBalsaServer::host field is set.
	* src/sendmsg-window.c: do not crash on replying to a message with
        empty To: header.

2003-10-31 Pawel Salek

	* libbalsa/folder-scanners.c: fix yesterday's change.
	* libbalsa/mailbox{,_maildir,_mh}.c:
	* libbalsa/{misc,pop3,send}.c: ditto.

2003-10-30 Pawel Salek

	* libbalsa/{folder-scanner,misc,pop3,send}.c: 
	* libbalsa/mailbox_{maildir,mh}.c: compile with stricter standard
	compatibility.
	* libbalsa/mailbox.[hc]: initial interface for server-side sorting.
	* libbalsa/mailbox_imap.c: same.
	* libbalsa/imap/imap-handle.c: improve handling of embedded msgs.
	* src/main-window.c: use ssize_t when apriopriate.

2003-10-27 17:06  PeterB

	* libbalsa/filter.c: Avoid casting a (const gchar *) to (gchar *).
	* libbalsa/mailbox_imap.c: Update message->msgno after expunge.

2003-10-25 18:29  PeterB

	* libbalsa/: mailbox_imap.c, mailbox_maildir.c, mailbox_mbox.c,
	mailbox_mh.c: Unref messages when closing mailbox.
	* src/balsa-mblist.c: Plug a memory leak.
	* src/balsa-index.c: Restore initial sort.
	* libbalsa/mailbox_imap.c: Imap `seen' flag has opposite sense to
	Balsa's `new' flag.
	* libbalsa/: mailbox.c, mailbox.h: Implement release_message
	method.
	* libbalsa/: mailbox_maildir.c, mailbox_mh.c: Add
	fetch_message_structure method and move creation of mime_msg to it
	from get_message; fetch_message_structure chains up to its parent's
	method; add release_message method, to unref message->mime_msg;
	make the mailbox's pointer to the mime_message a weak pointer.
	* libbalsa/: mailbox_local.c, mailbox_local.h: Implement
	_libbalsa_mailbox_local_get_mime_message, a helper for maildir and
	mh.
	* libbalsa/message.c: Use libbalsa_mailbox_release_message(); plug
	one memory leak.

2003-10-24 08:59  PeterB

	* libbalsa/imap/imap-handle.c: Remove always_has_data field and let
	the handlers check; use ir_check_crlf() to check syntax when
	response is empty.
	* libbalsa/mailbox_imap.c: Decode only nonNULL address phrase.
	* src/balsa-index.c: Get a bit further with message deletion.
	* libbalsa/imap/imap.h: Add ImapBody::content_uri--new in RFC 3051.
	* libbalsa/imap/imap-handle.c: Clarify BODY and BODYSTRUCTURE
	response handlers.
	* libbalsa/mailbox.c: Fix incorrect signal from 2003-10-22 commit.

2003-10-22 19:49  PeterB

	* libbalsa/: mailbox.c, mailbox_maildir.c, mailbox_mbox.c,
	mailbox_mh.c: Let the tree-model know when a message is deleted.
	* libbalsa/: mailbox_imap.c, imap/Makefile.am,
	imap/imap-commands.c, imap/imap-commands.h: Use GMimeStream to
	append a message.
	* libbalsa/mailbox_mbox.c: Use
	libbalsa_address_to_gchar(message->headers->from, 0) instead of
	g_mime_message_get_sender(message->mime_msg).
	* libbalsa/mailbox_imap.c: Use g_mime_utils_header_decode_text
	instead of deprecated g_mime_utils_8bit_header_decode.
	* libbalsa/mailbox_imap.c: Decode addresses.
	* libbalsa/imap/imap-handle.c: Check protocol in addresses.

2003-10-21 08:16  PeterB

	* libbalsa/files.c, libbalsa/message.c, src/balsa-index.c,
	src/balsa-index.h, src/balsa-message.c, src/main-window.c: More
	memory leaks.

2003-10-20 16:44  PeterB

	* libbalsa/address.c: Plug a memory leak.
	* src/: balsa-message.c, save-restore.c: Plug memory leaks.

2003-10-19  Carlos Morgado  <chbm gnome.org>

	* libbalsa/mailbox_imap.c (libbalsa_mailbox_imap_get_msg_part): 
	message part cache minus the cleanup bits 

2003-10-19  Carlos Morgado  <chbm gnome.org>

	* libbalsa/mailbox_imap.c (libbalsa_mailbox_imap_get_msg_part): 
	do crlf conversion, adhere to mailbox_local return
	this sucks. it won't stop sucking till we have part cache.
	
2003-10-18 09:04  PeterB

	* libbalsa/mailbox_imap.c: Populate
	LibBalsaMessageBody::content_dsp; fix get_section_for().
	* libbalsa/: body.c, body.h, message.c, rfc3156.c: Don't require
	body->mime_part != NULL.
	* libbalsa/imap/: imap-handle.c, imap.h: Handle extension info in
	BODYSTRUCTURE response.
	* libbalsa/imap/imap-commands.c: Fetch BODYSTRUCTURE to get
	structure.

2003-10-18  Carlos Morgado  <chbm gnome.org>

	* libbalsa/imap/imap.h: make ImapBodyEncoding match 
	GMime to make things smother
	
	* libbalsa/mailbox_imap.c (libbalsa_mailbox_imap_get_msg_part):
	return decoded part and add mime_part

	* libbalsa/imap/imap-handle.c:
	set body->media_basic_name

2003-10-15 14:24  PeterB

	* libbalsa/imap/imap-handle.c: Implement ir_check_crlf() and use it
	for protocol checking; use g_ascii_ stringcomparisons; add
	`always_has_data' info to ResponseHandlers structures and use it
	for more careful syntax checking.

2003-10-14  Pawel Salek  <pawsa theochem.kth.se>

	* libbalsa/mailbox.[hc]: remove old crap. fix sync_storage().

	* libbalsa/mailbox_{imap,maildir,mbox,mh}.c: adjustments to sync().
	* libbalsa/mailbox_local.c: remove old crap.
	* src/main-window.c: use new sync_storage() method

	* src/information-dialog.[ch]: 
	* src/main.c: fix bug 124568.

2003-10-14 08:36  PeterB

	* src/message-window.c: Trash the message in the window, not the
	current index selection (bug #124550).

2003-10-13  Pawel Salek  <pawsa theochem.kth.se>

	* libbalsa/message.h: libbalsa_message_send() accepts debug argument.
	* libbalsa/send.[hc]: use it.
	* src/balsa-message.c: pass debug argument.
	* src/{sendmsg,main}-window.c: ditto.

2003-10-12  Carlos Morgado  <chbm gnome.org>

	* libbalsa/mailbox_mh.c (libbalsa_mailbox_mh_add_message): 
	unref the filter_stream (duh)

2003-10-12  Carlos Morgado  <chbm gnome.org>

	* libbalsa/mailbox_mh.c: make _sync work on _close

2003-10-11 23:02  PeterB

	* libbalsa/: mailbox.c, mailbox.h: Implement GtkTreeSortable
	interface.

2003-10-11 18:42 Pawel Salek

	* libbalsa/mailbox.[hc]: add 
	libbalsa_mailbox_msgno_{inserted,changed,removed}().
	* libbalsa/mailbox_imap.c: handle flag changes, new messages, expunges

2003-10-11  Pawel Salek

	* libbalsa/mailbox.c: simplify libbalsa_mailbox_is_open().
	* libbalsa/mailbox_imap.[ch]: keep private data private.
	Add libbalsa_mailbox_imap_get_path().
	* libbalsa/imap/imap-handle.h: add IMFETCH_RFC822SIZE constant.
	* libbalsa/imap/imap-commands.c: handle this constant. plug mem leaks
	* src/mailbox-conf.c, src/mailbox-node.c, src/main-window.c: 
	use libbalsa_mailbox_imap_get_path().

2003-10-10 23:27  PeterB

	* src/main-window.c: Use register_balsa_pixbufs when the main
	window has been created.
	* src/balsa-index.c: Remove icon code.
	* src/: balsa-icons.c, balsa-icons.h: Impl. register_balsa_pixbufs
	to initialize the new mail icon, etc.
	* libbalsa/: message.c, message.h: Impl.
	libbalsa_message_set_status_icons; install local versions of
	libbalsa_message_is_multipart, etc., that work with the mailbox
	locked.
	* libbalsa/: mailbox_imap.c, mailbox_maildir.c, mailbox_mbox.c,
	mailbox_mh.c: Set message icons.
	* libbalsa/: mailbox.c, mailbox.h: Add api for setting new mail
	icon, etc.; use icons in LB_MBOX_MARKED_COL and LB_MBOX_ATTACH_COL;
	signal the tree-view when icons change.
	* libbalsa/mailbox_local.c: Fix message numbering for threading;
	check more carefully for potential loops in threads.

2003-10-09 12:09  PeterB

	* src/main-window.c: Add accelerators for zoom in/out.

2003-10-08 23:00  PeterB

	* libbalsa/: mailbox.c, mailbox.h: Add LB_MBOX_WEIGHT_COL, of type
	G_TYPE_UINT, to the mbox-tree-model.
	* src/balsa-index.c: Connect cell column renderers to
	LB_MBOX_WEIGHT_COL.
	* libbalsa/message.c: Call libbalsa_messages_read() on change of
	flag.
	* libbalsa/mailbox_mh.c: Don't check msgno--it was checked by the
	caller; store mime_message in LibBalsaMessage object; plug memory
	leak in _add_message.
	* libbalsa/mailbox_maildir.c: Don't check msgno--it was checked by
	the caller; store mime_message in LibBalsaMessage object.

2003-10-07 10:03  PeterB

	* src/balsa-index.c: Fix source viewer.

2003-10-05  Carlos Morgado  <chbm gnome.org>

	* src/sendmsg-window.c (do_insert_string_select_ch): #103639

2003-10-05  Pawel Salek

	* libbalsa/body.[hc]: do not require gmime for content-type.
	* src/balsa-message.c: ditto.
	* libbalsa/mailbox.[hc]: change _get_message_part API.
	* libbalsa/mailbox_{local,imap}.c: implement _get_message_part().
	* libbalsa/message.c: add forgotten UNLOCK.
	* libbalsa/imap/imap-commands.[hc]: backend support for get_part().
	* libbalsa/imap/imap-handle.[ch]: actually remember part parameters.
	* libbalsa/imap/imap.h: add params field.
	* src/balsa-index.c: cleanup.

2003-10-04  Pawel Salek

	* libbalsa/mailbox.[ch]: add prepare_threading,
	fetch_message_structure and get_message_part virtual functions.
	* libbalsa/mailbox_imap.c: prepare to implement above.
	* libbalsa/mailbox_local.[hc]: same. Change 
	LibBalsaMailbox::load_message to LibBalsaMailboxLocal.
	* libbalsa/mailbox_{maildir,mh}.c: adapt to above.
	* libbalsa/mailbox_mbox.c: ditto. Fix off-by-one bug.
	* libbalsa/message.c: use fetch_message_structure.
	* src/balsa-index.c: restore bndx_selection_changed_func().
	* src/save-restore.c: change default threading type to flat - it
	is faster.

2003-10-04 10:03  PeterB

	* libbalsa/: libbalsa.c, libbalsa.h, mailbox_local.h,
	mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c: Make
	libbalsa_mailbox_local_get_path() return (const gchar *).
	* libbalsa/mailbox_local.c: Use g_node_traverse to visit nodes--it
	really does visit all nodes.
	* libbalsa/mailbox_imap.c: Set msgno correctly when unthreaded.

2003-10-03 08:30  PeterB

	* libbalsa/: mailbox.c, mailbox_imap.c, mailbox_local.c,
	mailbox_maildir.c, mailbox_mbox.c, mailbox_mh.c, message.h:
	LibBalsaMessage::msgno starts at 1; use (msgno - 1) to index into
	arrays; install a close_mailbox method for
	LibBalsaMailboxLocal--free and clear msg_list.

2003-10-03  Pawel Salek <pawsa theochem.kth.se>

	Merge gtk-tree-model branch. For good.
	* libbalsa/mailbox.[hc]: GtkTreeModel implementation.
	* libbalsa/mailbox_{imap,local,maildir,mbox,mh,pop3}.[hc]: changed API.
	* libalsa/{message,send}.c: adapt to changed api.
	* libbalsa/imap/imap-handle.c: threading, message decoding improvements
	* libbalsa/imap/imap.h: added comments.
	* src/balsa-index.c: use GtkTreeModel interface to LibBalsaMailbox.
	* src/main-window.c: trash can be only local now.
	* src/sendmsg-window.c: merge draftbox code.
	* src/Makefile.am: remove balsa-index-threading.c: not used any more.

